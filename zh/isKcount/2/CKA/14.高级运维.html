<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.51" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://isKcount/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html"><meta property="og:site_name" content="æ–‡æ¡£æ¼”ç¤º"><meta property="og:title" content="Kubernetes é«˜çº§è¿ç»´"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-10-11T05:08:11.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:published_time" content="2022-01-22T12:12:13.000Z"><meta property="article:modified_time" content="2022-10-11T05:08:11.000Z"><link rel="icon" href="/cicd/favicon.ico"><link rel="icon" href="/cicd/assets/icon/chrome-mask-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/cicd/assets/icon/chrome-mask-192.png" type="image/png" sizes="192x192"><link rel="icon" href="/cicd/assets/icon/chrome-512.png" type="image/png" sizes="512x512"><link rel="icon" href="/cicd/assets/icon/chrome-192.png" type="image/png" sizes="192x192"><link rel="manifest" href="/cicd/manifest.webmanifest" crossorigin="use-credentials"><meta name="theme-color" content="#46bd87"><link rel="apple-touch-icon" href="/cicd/assets/icon/apple-icon-152.png"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="msapplication-TileImage" content="/cicd/assets/icon/ms-icon-144.png"><meta name="msapplication-TileColor" content="#ffffff"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"><title>Kubernetes é«˜çº§è¿ç»´ | æ–‡æ¡£æ¼”ç¤º</title><meta name="description" content="vuepress-theme-hope çš„æ–‡æ¡£æ¼”ç¤º">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/cicd/assets/style.b0cf8135.css">
    <link rel="modulepreload" href="/cicd/assets/app.4cf02e25.js"><link rel="modulepreload" href="/cicd/assets/14.é«˜çº§è¿ç»´.html.c7f0e1f0.js"><link rel="modulepreload" href="/cicd/assets/_plugin-vue_export-helper.cdc0426e.js"><link rel="modulepreload" href="/cicd/assets/14.é«˜çº§è¿ç»´.html.6fd84512.js"><link rel="prefetch" href="/cicd/assets/index.html.afb960cd.js"><link rel="prefetch" href="/cicd/assets/slides.html.75632ce0.js"><link rel="prefetch" href="/cicd/assets/disable.html.69aa87b2.js"><link rel="prefetch" href="/cicd/assets/encrypt.html.b6670895.js"><link rel="prefetch" href="/cicd/assets/markdown.html.b609aecf.js"><link rel="prefetch" href="/cicd/assets/page.html.54ab5bbb.js"><link rel="prefetch" href="/cicd/assets/index.html.45befc19.js"><link rel="prefetch" href="/cicd/assets/index.html.35bc4860.js"><link rel="prefetch" href="/cicd/assets/index.html.0bac633c.js"><link rel="prefetch" href="/cicd/assets/index.html.d697902a.js"><link rel="prefetch" href="/cicd/assets/baz.html.5f57b04e.js"><link rel="prefetch" href="/cicd/assets/index.html.6a953184.js"><link rel="prefetch" href="/cicd/assets/ray.html.e211c123.js"><link rel="prefetch" href="/cicd/assets/index.html.30154021.js"><link rel="prefetch" href="/cicd/assets/kaifa.html.1bb6461e.js"><link rel="prefetch" href="/cicd/assets/qukuailian.html.555b2023.js"><link rel="prefetch" href="/cicd/assets/index.html.430b7fe5.js"><link rel="prefetch" href="/cicd/assets/yunwei.html.64158b4e.js"><link rel="prefetch" href="/cicd/assets/CKA.html.0957d054.js"><link rel="prefetch" href="/cicd/assets/CKS.html.bd413494.js"><link rel="prefetch" href="/cicd/assets/index.html.ceda1bd4.js"><link rel="prefetch" href="/cicd/assets/è½¯ä»¶è®¾è®¡å¸ˆ.html.c5d81eaa.js"><link rel="prefetch" href="/cicd/assets/Goå¼€å‘.html.9a880fcf.js"><link rel="prefetch" href="/cicd/assets/Javaå¼€å‘.html.d877b9be.js"><link rel="prefetch" href="/cicd/assets/index.html.4068cd31.js"><link rel="prefetch" href="/cicd/assets/Ajax.html.dd9a85f6.js"><link rel="prefetch" href="/cicd/assets/CSS3.html.91a2e19a.js"><link rel="prefetch" href="/cicd/assets/HTML5.html.d4b38488.js"><link rel="prefetch" href="/cicd/assets/JavaScript DOM.html.9eaa65d5.js"><link rel="prefetch" href="/cicd/assets/JavaScriptå¼€ç¯‡.html.f60fb2e1.js"><link rel="prefetch" href="/cicd/assets/JavaScripté¢å‘å¯¹è±¡.html.da218289.js"><link rel="prefetch" href="/cicd/assets/JQuery.html.ae656a54.js"><link rel="prefetch" href="/cicd/assets/index.html.4e9fd026.js"><link rel="prefetch" href="/cicd/assets/Vue.html.3596c5e3.js"><link rel="prefetch" href="/cicd/assets/1.Gitlab-CIå…¥é—¨é…ç½®.html.8757c890.js"><link rel="prefetch" href="/cicd/assets/2.Gitlab-Runerè¿æ¥K8S.html.ceb7ae20.js"><link rel="prefetch" href="/cicd/assets/3.GitLab-CI _ Harbor _ Kubernetes.html.b7ec02df.js"><link rel="prefetch" href="/cicd/assets/4.Gitea_K8s-Jenkins-master-slave(webhooké’©å­).html.01e740cd.js"><link rel="prefetch" href="/cicd/assets/index.html.080ddb9c.js"><link rel="prefetch" href="/cicd/assets/1.Istioæ¦‚è¿°.html.9ddaefd7.js"><link rel="prefetch" href="/cicd/assets/2.Istioå®‰è£….html.0bd57f85.js"><link rel="prefetch" href="/cicd/assets/3.Istioçš„æ·±å…¥æµ….html.aff1e3cf.js"><link rel="prefetch" href="/cicd/assets/4.Istioç»ƒä¹ é¢˜.html.8fd3b51c.js"><link rel="prefetch" href="/cicd/assets/index.html.293eb095.js"><link rel="prefetch" href="/cicd/assets/1.æ·±å…¥ç†è§£Operator.html.1f267c48.js"><link rel="prefetch" href="/cicd/assets/2.RESTclientåŸç†.html.18487112.js"><link rel="prefetch" href="/cicd/assets/3.è®¿é—®Kubernetes API.html.da101cae.js"><link rel="prefetch" href="/cicd/assets/4.ä¸€æ–‡ææ‡‚CRD.html.392b012e.js"><link rel="prefetch" href="/cicd/assets/index.html.0f03a0a3.js"><link rel="prefetch" href="/cicd/assets/1.å¸¸ç”¨Gitå‘½ä»¤æ¸…å•.html.2cb1df75.js"><link rel="prefetch" href="/cicd/assets/10.Gitåˆ†æ”¯-å˜åŸº.html.b947479b.js"><link rel="prefetch" href="/cicd/assets/11.Gitå·¥å…·-æŸ¥çœ‹ä¿®è®¢ç‰ˆæœ¬.html.10aa9bfe.js"><link rel="prefetch" href="/cicd/assets/12.Gitå·¥å…·-äº¤äº’å¼æš‚å­˜.html.48884ded.js"><link rel="prefetch" href="/cicd/assets/13.Gitå·¥å…·-é‡å†™å†å².html.5d5eaa80.js"><link rel="prefetch" href="/cicd/assets/14.Gitå·¥å…·-é‡ç½®æ­å¯†.html.6633ce8a.js"><link rel="prefetch" href="/cicd/assets/2.Gitå˜åŸºåˆå¹¶.html.fa3da0d8.js"><link rel="prefetch" href="/cicd/assets/3.Gitå‘½ä»¤æ€ç»´å¯¼å›¾.html.15c6e161.js"><link rel="prefetch" href="/cicd/assets/4.GitåŸºç¡€ä¸å‘½ä»¤.html.73f55f94.js"><link rel="prefetch" href="/cicd/assets/5.Gitåˆ†æ”¯-åˆ†æ”¯åŸç†.html.3ec450a8.js"><link rel="prefetch" href="/cicd/assets/6.Gitåˆ†æ”¯çš„æ–°å»ºä¸åˆå¹¶-åˆ†æ”¯æ“ä½œ.html.014f3285.js"><link rel="prefetch" href="/cicd/assets/7.Gitåˆ†æ”¯ç®¡ç†-æŸ¥çœ‹åˆ†æ”¯.html.675bcb4c.js"><link rel="prefetch" href="/cicd/assets/8.Gitåˆ†æ”¯å¼€å‘å·¥ä½œæµ.html.d8b4cc3b.js"><link rel="prefetch" href="/cicd/assets/9.Gitåˆ†æ”¯-è¿œç¨‹åˆ†æ”¯.html.84949e28.js"><link rel="prefetch" href="/cicd/assets/index.html.600de791.js"><link rel="prefetch" href="/cicd/assets/01.åˆè¯†Kubernetes.html.eaa4f1ed.js"><link rel="prefetch" href="/cicd/assets/02.Kuberneteséƒ¨ç½².html.87861ae6.js"><link rel="prefetch" href="/cicd/assets/03.Containerdæ­å»ºKubernets.html.bc40478f.js"><link rel="prefetch" href="/cicd/assets/04.kubernetesåŸºæœ¬æ“ä½œ.html.7561f03f.js"><link rel="prefetch" href="/cicd/assets/05.Kubernetesç›‘æ§ä¸æ—¥å¿—ç®¡ç†.html.b39e53f4.js"><link rel="prefetch" href="/cicd/assets/06.Kubernetesåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸç®¡ç†.html.e31aed57.js"><link rel="prefetch" href="/cicd/assets/07.Kubernetesè°ƒåº¦.html.78a978fa.js"><link rel="prefetch" href="/cicd/assets/08.Kubernetesç½‘ç»œ.html.cde7916b.js"><link rel="prefetch" href="/cicd/assets/09.Kuberneteså­˜å‚¨.html.a76219a7.js"><link rel="prefetch" href="/cicd/assets/10.Kuberneteså®‰å…¨.html.a097f54b.js"><link rel="prefetch" href="/cicd/assets/11.Kubernetesé›†ç¾¤ç»´æŠ¤.html.d71c9de0.js"><link rel="prefetch" href="/cicd/assets/12.Kubernetesé›†ç¾¤æ•…éšœæ’æŸ¥.html.8c63d7cb.js"><link rel="prefetch" href="/cicd/assets/13.Helm.html.9b520a1c.js"><link rel="prefetch" href="/cicd/assets/15.NFSåšK8Såç«¯å­˜å‚¨.html.fad20088.js"><link rel="prefetch" href="/cicd/assets/16.Glusterfså¯¹æ¥K8S.html.ed2e5510.js"><link rel="prefetch" href="/cicd/assets/17.Cephå¯¹æ¥K8Så­˜å‚¨(RBD).html.5e02a595.js"><link rel="prefetch" href="/cicd/assets/18.Rookæ„å»ºCephäº‘åŸç”Ÿå­˜å‚¨.html.9ba766b8.js"><link rel="prefetch" href="/cicd/assets/19.Kubectlå¤šé›†ç¾¤é…ç½®.html.33834959.js"><link rel="prefetch" href="/cicd/assets/20.ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹é¢„ç•™è®¡ç®—èµ„æº.html.8e9298af.js"><link rel="prefetch" href="/cicd/assets/21.Helmæ­å»ºEFKæ—¥å¿—ç³»ç»Ÿ.html.4edbf6a4.js"><link rel="prefetch" href="/cicd/assets/22.Kubernetesçš„client-Python.html.c60456d9.js"><link rel="prefetch" href="/cicd/assets/23.kubectlå‘½ä»¤.html.8b18dbe9.js"><link rel="prefetch" href="/cicd/assets/01.é›†ç¾¤éƒ¨ç½²ä¸å®‰å…¨é…ç½®.html.b6b4f70f.js"><link rel="prefetch" href="/cicd/assets/02.é›†ç¾¤å¼ºåŒ–.html.fad18f43.js"><link rel="prefetch" href="/cicd/assets/03.å®¹å™¨è¿è¡Œç¯å¢ƒå®‰å…¨åŠ å›º.html.053ca706.js"><link rel="prefetch" href="/cicd/assets/04.æœ€å°åŒ–å¾®æœåŠ¡æ¼æ´.html.7b3b9ade.js"><link rel="prefetch" href="/cicd/assets/05.ä¾›åº”é“¾å®‰å…¨.html.a0900434.js"><link rel="prefetch" href="/cicd/assets/06.ç›‘æ§ã€å®¡è®¡å’Œè¿è¡Œæ—¶å®‰å…¨.html.7e2ba24b.js"><link rel="prefetch" href="/cicd/assets/index.html.c616b064.js"><link rel="prefetch" href="/cicd/assets/index.html.15eb079a.js"><link rel="prefetch" href="/cicd/assets/index.html.94ea93f5.js"><link rel="prefetch" href="/cicd/assets/index.html.079b2772.js"><link rel="prefetch" href="/cicd/assets/index.html.df3f4c13.js"><link rel="prefetch" href="/cicd/assets/index.html.0e6fd612.js"><link rel="prefetch" href="/cicd/assets/01.Cephéƒ¨ç½².html.c7edc1a7.js"><link rel="prefetch" href="/cicd/assets/01.Elasticsearchæ•™ç¨‹.html.c70bc6f4.js"><link rel="prefetch" href="/cicd/assets/02.SpringBootæ•´åˆES.html.58d48662.js"><link rel="prefetch" href="/cicd/assets/01.NginxåŸºç¡€.html.cf2f1274.js"><link rel="prefetch" href="/cicd/assets/02.Nginxåå‘ä»£ç†.html.5c1d75f4.js"><link rel="prefetch" href="/cicd/assets/03.Nginxè´Ÿè½½å‡è¡¡.html.01375d35.js"><link rel="prefetch" href="/cicd/assets/04.NginxåŠ¨é™åˆ†ç¦».html.567ee358.js"><link rel="prefetch" href="/cicd/assets/05.Nginxé«˜å¯ç”¨.html.e6a3ddc7.js"><link rel="prefetch" href="/cicd/assets/01.MySQLå®‰è£….html.a857908f.js"><link rel="prefetch" href="/cicd/assets/02.MySQLæ¦‚è¿°.html.215c677f.js"><link rel="prefetch" href="/cicd/assets/03.MySQLçš„SQLè¯¦è§£.html.b436424d.js"><link rel="prefetch" href="/cicd/assets/04.MySQLçš„å‡½æ•°.html.f2d51481.js"><link rel="prefetch" href="/cicd/assets/05.MySQLçš„çº¦æŸ.html.bad191da.js"><link rel="prefetch" href="/cicd/assets/06.MySQLå¤šè¡¨æŸ¥è¯¢.html.36361e11.js"><link rel="prefetch" href="/cicd/assets/07.MySQLçš„äº‹åŠ¡.html.9cb08bc8.js"><link rel="prefetch" href="/cicd/assets/08.MySQLç´¢å¼•.html.a88e7348.js"><link rel="prefetch" href="/cicd/assets/01.Redisè¯¦è§£.html.74500c58.js"><link rel="prefetch" href="/cicd/assets/02.SpringBootæ•´åˆRedis.html.469f0ecc.js"><link rel="prefetch" href="/cicd/assets/1.html.51ad6998.js"><link rel="prefetch" href="/cicd/assets/10.html.9f9ea17a.js"><link rel="prefetch" href="/cicd/assets/2.html.b10c281c.js"><link rel="prefetch" href="/cicd/assets/3.html.e9f1871a.js"><link rel="prefetch" href="/cicd/assets/4.html.1fff6eef.js"><link rel="prefetch" href="/cicd/assets/5.html.97811964.js"><link rel="prefetch" href="/cicd/assets/6.html.8b926579.js"><link rel="prefetch" href="/cicd/assets/7.html.46240a78.js"><link rel="prefetch" href="/cicd/assets/8.html.8a1b2295.js"><link rel="prefetch" href="/cicd/assets/9.html.4409806f.js"><link rel="prefetch" href="/cicd/assets/1.html.9af07abf.js"><link rel="prefetch" href="/cicd/assets/2.html.2fcadf0b.js"><link rel="prefetch" href="/cicd/assets/3.html.f030d923.js"><link rel="prefetch" href="/cicd/assets/4.html.470bb9d1.js"><link rel="prefetch" href="/cicd/assets/5.html.f01a11dd.js"><link rel="prefetch" href="/cicd/assets/6.html.8186092c.js"><link rel="prefetch" href="/cicd/assets/7.html.6fc24329.js"><link rel="prefetch" href="/cicd/assets/8.html.10ead5f0.js"><link rel="prefetch" href="/cicd/assets/9.html.41d3dbca.js"><link rel="prefetch" href="/cicd/assets/10.html.4cebe03d.js"><link rel="prefetch" href="/cicd/assets/11.html.8f240263.js"><link rel="prefetch" href="/cicd/assets/2.html.5569587e.js"><link rel="prefetch" href="/cicd/assets/3.html.9a65d44c.js"><link rel="prefetch" href="/cicd/assets/4.html.75bbb016.js"><link rel="prefetch" href="/cicd/assets/5.html.d4539629.js"><link rel="prefetch" href="/cicd/assets/6.html.36bd59fc.js"><link rel="prefetch" href="/cicd/assets/7.html.4486fb3b.js"><link rel="prefetch" href="/cicd/assets/8.html.0197b422.js"><link rel="prefetch" href="/cicd/assets/9.html.6884113c.js"><link rel="prefetch" href="/cicd/assets/awk.html.f6d4fea2.js"><link rel="prefetch" href="/cicd/assets/01.Javaç¯å¢ƒé…ç½®.html.9a82b76a.js"><link rel="prefetch" href="/cicd/assets/02.JavaåŸºç¡€æ¦‚å¿µ.html.371f29d8.js"><link rel="prefetch" href="/cicd/assets/03.Javaè¿ç®—ç¬¦.html.aaf325c2.js"><link rel="prefetch" href="/cicd/assets/04.Javaå¾ªç¯å’Œåˆ¤æ–­.html.167b49db.js"><link rel="prefetch" href="/cicd/assets/05.Javaå¾ªç¯é«˜çº§å’Œæ•°ç»„.html.ee86ed78.js"><link rel="prefetch" href="/cicd/assets/06.Javaæ–¹æ³•.html.b0098a64.js"><link rel="prefetch" href="/cicd/assets/07.Javaé¢å‘å¯¹è±¡.html.3e5a2e10.js"><link rel="prefetch" href="/cicd/assets/08.Javaå­—ç¬¦ä¸².html.226000a4.js"><link rel="prefetch" href="/cicd/assets/00.Javaé¢å¯¹å¯¹è±¡è¿›é˜¶.html.89001477.js"><link rel="prefetch" href="/cicd/assets/01.æ—¥æœŸå’Œæ—¶é—´.html.1fa0d266.js"><link rel="prefetch" href="/cicd/assets/02.æ­£åˆ™è¡¨è¾¾å¼.html.692fb7f2.js"><link rel="prefetch" href="/cicd/assets/03.é›†åˆ.html.7aef52e6.js"><link rel="prefetch" href="/cicd/assets/04.Streamæµ.html.22c04447.js"><link rel="prefetch" href="/cicd/assets/05.å¼‚å¸¸å¤„ç†.html.0bcfd771.js"><link rel="prefetch" href="/cicd/assets/06.æ—¥å¿—æ¡†æ¶.html.7c3b687d.js"><link rel="prefetch" href="/cicd/assets/07.Fileç±»ã€IOæµ.html.95b3fdca.js"><link rel="prefetch" href="/cicd/assets/08.IOæµè¿›é˜¶.html.b0ff2a19.js"><link rel="prefetch" href="/cicd/assets/09.å¤šçº¿ç¨‹.html.36474e00.js"><link rel="prefetch" href="/cicd/assets/10.ç½‘ç»œç¼–ç¨‹.html.00117829.js"><link rel="prefetch" href="/cicd/assets/11.å•å…ƒæµ‹è¯•å’Œåå°„.html.0c2e7d58.js"><link rel="prefetch" href="/cicd/assets/12.æ³¨è§£å’ŒåŠ¨æ€ä»£ç†.html.3f4f6fc8.js"><link rel="prefetch" href="/cicd/assets/13.XMLå’Œè®¾è®¡æ¨¡å¼.html.15865193.js"><link rel="prefetch" href="/cicd/assets/01.SpringBootå¿«é€Ÿå…¥é—¨.html.36346b67.js"><link rel="prefetch" href="/cicd/assets/02.SpringBooté…ç½®æ–‡ä»¶.html.faa01534.js"><link rel="prefetch" href="/cicd/assets/03.æ•´åˆJunitå’ŒMybatis.html.8df025df.js"><link rel="prefetch" href="/cicd/assets/04.SpringBootæ—¥å¿—.html.0753c3c2.js"><link rel="prefetch" href="/cicd/assets/05.SpringBootå¸¸ç”¨æ³¨è§£.html.60025afe.js"><link rel="prefetch" href="/cicd/assets/06.SpringBootå¼€å‘é…ç½®.html.d06a3ecf.js"><link rel="prefetch" href="/cicd/assets/07.SpringBootæ•°æ®å±‚æ–¹æ¡ˆ.html.7249472a.js"><link rel="prefetch" href="/cicd/assets/08.SpringBootæ•´åˆç¬¬ä¸‰æ–¹æŠ€æœ¯.html.99e6c044.js"><link rel="prefetch" href="/cicd/assets/01.Springçš„IoCå’ŒDI.html.a9b2e188.js"><link rel="prefetch" href="/cicd/assets/02.IoCå’ŒDIæ³¨è§£å¼€å‘.html.d0c453d8.js"><link rel="prefetch" href="/cicd/assets/03.Springçš„MVCå…¥é—¨.html.5697eb9d.js"><link rel="prefetch" href="/cicd/assets/04.SpringMVCçš„è¯·æ±‚å’Œå“åº”.html.5c7a7c1c.js"><link rel="prefetch" href="/cicd/assets/05.Springæ•´åˆJdbc.html.9902e59c.js"><link rel="prefetch" href="/cicd/assets/06.SpringMVCé¡¹ç›®çš„å¸¸ç”¨é…ç½®.html.df7d7078.js"><link rel="prefetch" href="/cicd/assets/07.SpringMVCæ‹¦æˆªå™¨.html.a7993a74.js"><link rel="prefetch" href="/cicd/assets/08.Springçš„å¼‚å¸¸å¤„ç†.html.ec7b0c4b.js"><link rel="prefetch" href="/cicd/assets/09.Springçš„AOP.html.ee2e4e31.js"><link rel="prefetch" href="/cicd/assets/10.Springçš„äº‹åŠ¡ç®¡ç†.html.e0ef8186.js"><link rel="prefetch" href="/cicd/assets/11.Mybatiså…¥é—¨.html.a9e5f73e.js"><link rel="prefetch" href="/cicd/assets/12.Mybatiså¤šè¡¨æŸ¥è¯¢.html.a4eb2c6e.js"><link rel="prefetch" href="/cicd/assets/13.Mybatisæ³¨è§£å¼€å‘.html.0724863a.js"><link rel="prefetch" href="/cicd/assets/14.MyBatisPlus.html.3ee508f1.js"><link rel="prefetch" href="/cicd/assets/404.html.982bee40.js"><link rel="prefetch" href="/cicd/assets/index.html.a2a1c31f.js"><link rel="prefetch" href="/cicd/assets/slides.html.6bbddf5e.js"><link rel="prefetch" href="/cicd/assets/disable.html.95e3aa74.js"><link rel="prefetch" href="/cicd/assets/encrypt.html.be1cd07d.js"><link rel="prefetch" href="/cicd/assets/markdown.html.07291620.js"><link rel="prefetch" href="/cicd/assets/page.html.efe64bc0.js"><link rel="prefetch" href="/cicd/assets/index.html.6daa34f0.js"><link rel="prefetch" href="/cicd/assets/index.html.13b82c1e.js"><link rel="prefetch" href="/cicd/assets/index.html.62d9f295.js"><link rel="prefetch" href="/cicd/assets/index.html.cdece030.js"><link rel="prefetch" href="/cicd/assets/baz.html.71f6f9c1.js"><link rel="prefetch" href="/cicd/assets/index.html.3c998f77.js"><link rel="prefetch" href="/cicd/assets/ray.html.c0ffbf8e.js"><link rel="prefetch" href="/cicd/assets/index.html.b9c72545.js"><link rel="prefetch" href="/cicd/assets/kaifa.html.e4e427e1.js"><link rel="prefetch" href="/cicd/assets/qukuailian.html.3a3f9161.js"><link rel="prefetch" href="/cicd/assets/index.html.4a3f7919.js"><link rel="prefetch" href="/cicd/assets/yunwei.html.b80da8e6.js"><link rel="prefetch" href="/cicd/assets/CKA.html.4fa6fe9b.js"><link rel="prefetch" href="/cicd/assets/CKS.html.70dc4199.js"><link rel="prefetch" href="/cicd/assets/index.html.22cb33eb.js"><link rel="prefetch" href="/cicd/assets/è½¯ä»¶è®¾è®¡å¸ˆ.html.acd3b108.js"><link rel="prefetch" href="/cicd/assets/Goå¼€å‘.html.0260ea94.js"><link rel="prefetch" href="/cicd/assets/Javaå¼€å‘.html.05229914.js"><link rel="prefetch" href="/cicd/assets/index.html.45da941e.js"><link rel="prefetch" href="/cicd/assets/Ajax.html.65ada00f.js"><link rel="prefetch" href="/cicd/assets/CSS3.html.a56db5bd.js"><link rel="prefetch" href="/cicd/assets/HTML5.html.178971c0.js"><link rel="prefetch" href="/cicd/assets/JavaScript DOM.html.4e057b6a.js"><link rel="prefetch" href="/cicd/assets/JavaScriptå¼€ç¯‡.html.e94d748e.js"><link rel="prefetch" href="/cicd/assets/JavaScripté¢å‘å¯¹è±¡.html.88b3d982.js"><link rel="prefetch" href="/cicd/assets/JQuery.html.8057b349.js"><link rel="prefetch" href="/cicd/assets/index.html.a6892502.js"><link rel="prefetch" href="/cicd/assets/Vue.html.64efef8c.js"><link rel="prefetch" href="/cicd/assets/1.Gitlab-CIå…¥é—¨é…ç½®.html.843f6524.js"><link rel="prefetch" href="/cicd/assets/2.Gitlab-Runerè¿æ¥K8S.html.94571695.js"><link rel="prefetch" href="/cicd/assets/3.GitLab-CI _ Harbor _ Kubernetes.html.62744790.js"><link rel="prefetch" href="/cicd/assets/4.Gitea_K8s-Jenkins-master-slave(webhooké’©å­).html.fb8fbb35.js"><link rel="prefetch" href="/cicd/assets/index.html.240d8ec8.js"><link rel="prefetch" href="/cicd/assets/1.Istioæ¦‚è¿°.html.0b22cafd.js"><link rel="prefetch" href="/cicd/assets/2.Istioå®‰è£….html.f6f954c2.js"><link rel="prefetch" href="/cicd/assets/3.Istioçš„æ·±å…¥æµ….html.d60ecce2.js"><link rel="prefetch" href="/cicd/assets/4.Istioç»ƒä¹ é¢˜.html.e13d5263.js"><link rel="prefetch" href="/cicd/assets/index.html.e513eb42.js"><link rel="prefetch" href="/cicd/assets/1.æ·±å…¥ç†è§£Operator.html.f92497be.js"><link rel="prefetch" href="/cicd/assets/2.RESTclientåŸç†.html.e8ff63dd.js"><link rel="prefetch" href="/cicd/assets/3.è®¿é—®Kubernetes API.html.4e49043e.js"><link rel="prefetch" href="/cicd/assets/4.ä¸€æ–‡ææ‡‚CRD.html.76a67cd5.js"><link rel="prefetch" href="/cicd/assets/index.html.6a4fd79e.js"><link rel="prefetch" href="/cicd/assets/1.å¸¸ç”¨Gitå‘½ä»¤æ¸…å•.html.7ff17fa9.js"><link rel="prefetch" href="/cicd/assets/10.Gitåˆ†æ”¯-å˜åŸº.html.d9d5fc96.js"><link rel="prefetch" href="/cicd/assets/11.Gitå·¥å…·-æŸ¥çœ‹ä¿®è®¢ç‰ˆæœ¬.html.ea0c9522.js"><link rel="prefetch" href="/cicd/assets/12.Gitå·¥å…·-äº¤äº’å¼æš‚å­˜.html.71a1ebc3.js"><link rel="prefetch" href="/cicd/assets/13.Gitå·¥å…·-é‡å†™å†å².html.de8b88f9.js"><link rel="prefetch" href="/cicd/assets/14.Gitå·¥å…·-é‡ç½®æ­å¯†.html.3cd77c28.js"><link rel="prefetch" href="/cicd/assets/2.Gitå˜åŸºåˆå¹¶.html.213a717c.js"><link rel="prefetch" href="/cicd/assets/3.Gitå‘½ä»¤æ€ç»´å¯¼å›¾.html.038c27f5.js"><link rel="prefetch" href="/cicd/assets/4.GitåŸºç¡€ä¸å‘½ä»¤.html.60ed1571.js"><link rel="prefetch" href="/cicd/assets/5.Gitåˆ†æ”¯-åˆ†æ”¯åŸç†.html.b6cdc2db.js"><link rel="prefetch" href="/cicd/assets/6.Gitåˆ†æ”¯çš„æ–°å»ºä¸åˆå¹¶-åˆ†æ”¯æ“ä½œ.html.f7495958.js"><link rel="prefetch" href="/cicd/assets/7.Gitåˆ†æ”¯ç®¡ç†-æŸ¥çœ‹åˆ†æ”¯.html.cbe5b302.js"><link rel="prefetch" href="/cicd/assets/8.Gitåˆ†æ”¯å¼€å‘å·¥ä½œæµ.html.a3773721.js"><link rel="prefetch" href="/cicd/assets/9.Gitåˆ†æ”¯-è¿œç¨‹åˆ†æ”¯.html.f02b650d.js"><link rel="prefetch" href="/cicd/assets/index.html.9430da9c.js"><link rel="prefetch" href="/cicd/assets/01.åˆè¯†Kubernetes.html.718e6748.js"><link rel="prefetch" href="/cicd/assets/02.Kuberneteséƒ¨ç½².html.23c2f087.js"><link rel="prefetch" href="/cicd/assets/03.Containerdæ­å»ºKubernets.html.e8dc2fb9.js"><link rel="prefetch" href="/cicd/assets/04.kubernetesåŸºæœ¬æ“ä½œ.html.0af76b6a.js"><link rel="prefetch" href="/cicd/assets/05.Kubernetesç›‘æ§ä¸æ—¥å¿—ç®¡ç†.html.a594c3c4.js"><link rel="prefetch" href="/cicd/assets/06.Kubernetesåº”ç”¨ç¨‹åºç”Ÿå‘½å‘¨æœŸç®¡ç†.html.200ffb58.js"><link rel="prefetch" href="/cicd/assets/07.Kubernetesè°ƒåº¦.html.14c32ccd.js"><link rel="prefetch" href="/cicd/assets/08.Kubernetesç½‘ç»œ.html.9c5c9140.js"><link rel="prefetch" href="/cicd/assets/09.Kuberneteså­˜å‚¨.html.3b313902.js"><link rel="prefetch" href="/cicd/assets/10.Kuberneteså®‰å…¨.html.2e9fe6b9.js"><link rel="prefetch" href="/cicd/assets/11.Kubernetesé›†ç¾¤ç»´æŠ¤.html.1acd8f93.js"><link rel="prefetch" href="/cicd/assets/12.Kubernetesé›†ç¾¤æ•…éšœæ’æŸ¥.html.8f29c4b0.js"><link rel="prefetch" href="/cicd/assets/13.Helm.html.26881fb7.js"><link rel="prefetch" href="/cicd/assets/15.NFSåšK8Såç«¯å­˜å‚¨.html.24ca6a24.js"><link rel="prefetch" href="/cicd/assets/16.Glusterfså¯¹æ¥K8S.html.ad02c1e8.js"><link rel="prefetch" href="/cicd/assets/17.Cephå¯¹æ¥K8Så­˜å‚¨(RBD).html.1d95bb20.js"><link rel="prefetch" href="/cicd/assets/18.Rookæ„å»ºCephäº‘åŸç”Ÿå­˜å‚¨.html.2ba920ae.js"><link rel="prefetch" href="/cicd/assets/19.Kubectlå¤šé›†ç¾¤é…ç½®.html.e8f8f7c4.js"><link rel="prefetch" href="/cicd/assets/20.ç³»ç»Ÿå®ˆæŠ¤è¿›ç¨‹é¢„ç•™è®¡ç®—èµ„æº.html.b1949ea8.js"><link rel="prefetch" href="/cicd/assets/21.Helmæ­å»ºEFKæ—¥å¿—ç³»ç»Ÿ.html.ba0060b8.js"><link rel="prefetch" href="/cicd/assets/22.Kubernetesçš„client-Python.html.4c201fe0.js"><link rel="prefetch" href="/cicd/assets/23.kubectlå‘½ä»¤.html.7ee5462d.js"><link rel="prefetch" href="/cicd/assets/01.é›†ç¾¤éƒ¨ç½²ä¸å®‰å…¨é…ç½®.html.6cf2ea7f.js"><link rel="prefetch" href="/cicd/assets/02.é›†ç¾¤å¼ºåŒ–.html.c2fb1f15.js"><link rel="prefetch" href="/cicd/assets/03.å®¹å™¨è¿è¡Œç¯å¢ƒå®‰å…¨åŠ å›º.html.53af5d4e.js"><link rel="prefetch" href="/cicd/assets/04.æœ€å°åŒ–å¾®æœåŠ¡æ¼æ´.html.606e1d3f.js"><link rel="prefetch" href="/cicd/assets/05.ä¾›åº”é“¾å®‰å…¨.html.a66192c3.js"><link rel="prefetch" href="/cicd/assets/06.ç›‘æ§ã€å®¡è®¡å’Œè¿è¡Œæ—¶å®‰å…¨.html.2ea5babd.js"><link rel="prefetch" href="/cicd/assets/index.html.1b7f3e44.js"><link rel="prefetch" href="/cicd/assets/index.html.5b7c881b.js"><link rel="prefetch" href="/cicd/assets/index.html.26cf0adf.js"><link rel="prefetch" href="/cicd/assets/index.html.b5915dba.js"><link rel="prefetch" href="/cicd/assets/index.html.41d43bd1.js"><link rel="prefetch" href="/cicd/assets/index.html.b13345ab.js"><link rel="prefetch" href="/cicd/assets/01.Cephéƒ¨ç½².html.79418d50.js"><link rel="prefetch" href="/cicd/assets/01.Elasticsearchæ•™ç¨‹.html.ef061c1a.js"><link rel="prefetch" href="/cicd/assets/02.SpringBootæ•´åˆES.html.a6432d91.js"><link rel="prefetch" href="/cicd/assets/01.NginxåŸºç¡€.html.bc28dbaf.js"><link rel="prefetch" href="/cicd/assets/02.Nginxåå‘ä»£ç†.html.a20c2185.js"><link rel="prefetch" href="/cicd/assets/03.Nginxè´Ÿè½½å‡è¡¡.html.3475fc9a.js"><link rel="prefetch" href="/cicd/assets/04.NginxåŠ¨é™åˆ†ç¦».html.bbca1346.js"><link rel="prefetch" href="/cicd/assets/05.Nginxé«˜å¯ç”¨.html.3ff4556a.js"><link rel="prefetch" href="/cicd/assets/01.MySQLå®‰è£….html.c8b7a632.js"><link rel="prefetch" href="/cicd/assets/02.MySQLæ¦‚è¿°.html.bc85cfe8.js"><link rel="prefetch" href="/cicd/assets/03.MySQLçš„SQLè¯¦è§£.html.94db624e.js"><link rel="prefetch" href="/cicd/assets/04.MySQLçš„å‡½æ•°.html.7ac6b66e.js"><link rel="prefetch" href="/cicd/assets/05.MySQLçš„çº¦æŸ.html.346ce6fc.js"><link rel="prefetch" href="/cicd/assets/06.MySQLå¤šè¡¨æŸ¥è¯¢.html.42d44f24.js"><link rel="prefetch" href="/cicd/assets/07.MySQLçš„äº‹åŠ¡.html.4ca4e973.js"><link rel="prefetch" href="/cicd/assets/08.MySQLç´¢å¼•.html.d4f9419f.js"><link rel="prefetch" href="/cicd/assets/01.Redisè¯¦è§£.html.11673a0c.js"><link rel="prefetch" href="/cicd/assets/02.SpringBootæ•´åˆRedis.html.017384ad.js"><link rel="prefetch" href="/cicd/assets/1.html.10321f45.js"><link rel="prefetch" href="/cicd/assets/10.html.d41b1bac.js"><link rel="prefetch" href="/cicd/assets/2.html.3a698947.js"><link rel="prefetch" href="/cicd/assets/3.html.826870e0.js"><link rel="prefetch" href="/cicd/assets/4.html.cf3356c9.js"><link rel="prefetch" href="/cicd/assets/5.html.2797d83f.js"><link rel="prefetch" href="/cicd/assets/6.html.2945720d.js"><link rel="prefetch" href="/cicd/assets/7.html.345f6876.js"><link rel="prefetch" href="/cicd/assets/8.html.22eeaf17.js"><link rel="prefetch" href="/cicd/assets/9.html.fb97463e.js"><link rel="prefetch" href="/cicd/assets/1.html.1bc685b4.js"><link rel="prefetch" href="/cicd/assets/2.html.cece9490.js"><link rel="prefetch" href="/cicd/assets/3.html.0f468b41.js"><link rel="prefetch" href="/cicd/assets/4.html.f146419f.js"><link rel="prefetch" href="/cicd/assets/5.html.3d122983.js"><link rel="prefetch" href="/cicd/assets/6.html.c878bea8.js"><link rel="prefetch" href="/cicd/assets/7.html.d8066882.js"><link rel="prefetch" href="/cicd/assets/8.html.6a7ca4b4.js"><link rel="prefetch" href="/cicd/assets/9.html.1977ed66.js"><link rel="prefetch" href="/cicd/assets/10.html.70e5e391.js"><link rel="prefetch" href="/cicd/assets/11.html.fde4ea88.js"><link rel="prefetch" href="/cicd/assets/2.html.a4c229e2.js"><link rel="prefetch" href="/cicd/assets/3.html.1f1466b3.js"><link rel="prefetch" href="/cicd/assets/4.html.bbe498e7.js"><link rel="prefetch" href="/cicd/assets/5.html.ef61f3b0.js"><link rel="prefetch" href="/cicd/assets/6.html.2c8d703e.js"><link rel="prefetch" href="/cicd/assets/7.html.24541ac0.js"><link rel="prefetch" href="/cicd/assets/8.html.6fc3bd96.js"><link rel="prefetch" href="/cicd/assets/9.html.f6352ede.js"><link rel="prefetch" href="/cicd/assets/awk.html.b95e15bc.js"><link rel="prefetch" href="/cicd/assets/01.Javaç¯å¢ƒé…ç½®.html.844b0dea.js"><link rel="prefetch" href="/cicd/assets/02.JavaåŸºç¡€æ¦‚å¿µ.html.b108d44e.js"><link rel="prefetch" href="/cicd/assets/03.Javaè¿ç®—ç¬¦.html.bd2cfbfa.js"><link rel="prefetch" href="/cicd/assets/04.Javaå¾ªç¯å’Œåˆ¤æ–­.html.5338a35d.js"><link rel="prefetch" href="/cicd/assets/05.Javaå¾ªç¯é«˜çº§å’Œæ•°ç»„.html.e00599ce.js"><link rel="prefetch" href="/cicd/assets/06.Javaæ–¹æ³•.html.7bb52ddb.js"><link rel="prefetch" href="/cicd/assets/07.Javaé¢å‘å¯¹è±¡.html.1079eb2b.js"><link rel="prefetch" href="/cicd/assets/08.Javaå­—ç¬¦ä¸².html.b901cbca.js"><link rel="prefetch" href="/cicd/assets/00.Javaé¢å¯¹å¯¹è±¡è¿›é˜¶.html.8918d3ae.js"><link rel="prefetch" href="/cicd/assets/01.æ—¥æœŸå’Œæ—¶é—´.html.348c00bd.js"><link rel="prefetch" href="/cicd/assets/02.æ­£åˆ™è¡¨è¾¾å¼.html.50ebd968.js"><link rel="prefetch" href="/cicd/assets/03.é›†åˆ.html.49082e37.js"><link rel="prefetch" href="/cicd/assets/04.Streamæµ.html.68f40f0d.js"><link rel="prefetch" href="/cicd/assets/05.å¼‚å¸¸å¤„ç†.html.29a650ed.js"><link rel="prefetch" href="/cicd/assets/06.æ—¥å¿—æ¡†æ¶.html.3ba2ce90.js"><link rel="prefetch" href="/cicd/assets/07.Fileç±»ã€IOæµ.html.6004e11e.js"><link rel="prefetch" href="/cicd/assets/08.IOæµè¿›é˜¶.html.93d298d8.js"><link rel="prefetch" href="/cicd/assets/09.å¤šçº¿ç¨‹.html.db4ffd29.js"><link rel="prefetch" href="/cicd/assets/10.ç½‘ç»œç¼–ç¨‹.html.f919c8a9.js"><link rel="prefetch" href="/cicd/assets/11.å•å…ƒæµ‹è¯•å’Œåå°„.html.afdbe08a.js"><link rel="prefetch" href="/cicd/assets/12.æ³¨è§£å’ŒåŠ¨æ€ä»£ç†.html.2c795104.js"><link rel="prefetch" href="/cicd/assets/13.XMLå’Œè®¾è®¡æ¨¡å¼.html.3d0c311c.js"><link rel="prefetch" href="/cicd/assets/01.SpringBootå¿«é€Ÿå…¥é—¨.html.b15e5cee.js"><link rel="prefetch" href="/cicd/assets/02.SpringBooté…ç½®æ–‡ä»¶.html.a51b7c4d.js"><link rel="prefetch" href="/cicd/assets/03.æ•´åˆJunitå’ŒMybatis.html.88ff751a.js"><link rel="prefetch" href="/cicd/assets/04.SpringBootæ—¥å¿—.html.cefe801e.js"><link rel="prefetch" href="/cicd/assets/05.SpringBootå¸¸ç”¨æ³¨è§£.html.6d4915ed.js"><link rel="prefetch" href="/cicd/assets/06.SpringBootå¼€å‘é…ç½®.html.eaeb29c4.js"><link rel="prefetch" href="/cicd/assets/07.SpringBootæ•°æ®å±‚æ–¹æ¡ˆ.html.66233b05.js"><link rel="prefetch" href="/cicd/assets/08.SpringBootæ•´åˆç¬¬ä¸‰æ–¹æŠ€æœ¯.html.72fb537e.js"><link rel="prefetch" href="/cicd/assets/01.Springçš„IoCå’ŒDI.html.baa8886c.js"><link rel="prefetch" href="/cicd/assets/02.IoCå’ŒDIæ³¨è§£å¼€å‘.html.d79783cd.js"><link rel="prefetch" href="/cicd/assets/03.Springçš„MVCå…¥é—¨.html.539104f8.js"><link rel="prefetch" href="/cicd/assets/04.SpringMVCçš„è¯·æ±‚å’Œå“åº”.html.028bbdf3.js"><link rel="prefetch" href="/cicd/assets/05.Springæ•´åˆJdbc.html.53c21fb4.js"><link rel="prefetch" href="/cicd/assets/06.SpringMVCé¡¹ç›®çš„å¸¸ç”¨é…ç½®.html.6eda597e.js"><link rel="prefetch" href="/cicd/assets/07.SpringMVCæ‹¦æˆªå™¨.html.1b33a69b.js"><link rel="prefetch" href="/cicd/assets/08.Springçš„å¼‚å¸¸å¤„ç†.html.a8841457.js"><link rel="prefetch" href="/cicd/assets/09.Springçš„AOP.html.dfaed15c.js"><link rel="prefetch" href="/cicd/assets/10.Springçš„äº‹åŠ¡ç®¡ç†.html.03810ef4.js"><link rel="prefetch" href="/cicd/assets/11.Mybatiså…¥é—¨.html.e46a9d31.js"><link rel="prefetch" href="/cicd/assets/12.Mybatiså¤šè¡¨æŸ¥è¯¢.html.ef88ef89.js"><link rel="prefetch" href="/cicd/assets/13.Mybatisæ³¨è§£å¼€å‘.html.c9eb015f.js"><link rel="prefetch" href="/cicd/assets/14.MyBatisPlus.html.b2b54d4f.js"><link rel="prefetch" href="/cicd/assets/404.html.792fbdca.js"><link rel="prefetch" href="/cicd/assets/auto.264f6c8c.js"><link rel="prefetch" href="/cicd/assets/index.cac02f97.js"><link rel="prefetch" href="/cicd/assets/flowchart.parse.ee90d7e0.js"><link rel="prefetch" href="/cicd/assets/mermaid.esm.min.e3b5d21d.js"><link rel="prefetch" href="/cicd/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/cicd/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/cicd/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/cicd/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/cicd/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/cicd/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/cicd/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/cicd/assets/VuePlayground.74354207.js"><link rel="prefetch" href="/cicd/assets/photoswipe.esm.382b1873.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/cicd/zh" class="brand"><img class="logo" src="/cicd/logo.svg" alt="æ–‡æ¡£æ¼”ç¤º"><!----><span class="site-name hide-in-pad">æ–‡æ¡£æ¼”ç¤º</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/cicd/zh" class="nav-link" aria-label="isKcount"><span class="icon iconfont icon-home"></span>isKcount<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="åˆ†ç±»"><span class="title"><span class="icon iconfont icon-interact"></span>åˆ†ç±»</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/cicd/zh/isKcount/1/" class="nav-link" aria-label="å­¦ä¹ è·¯çº¿è§„åˆ’"><span class="icon iconfont icon-ability"></span>å­¦ä¹ è·¯çº¿è§„åˆ’<!----></a></li><li class="dropdown-item"><a href="/cicd/zh/isKcount/2/" class="nav-link active" aria-label="è€ƒè¯"><span class="icon iconfont icon-relation"></span>è€ƒè¯<!----></a></li><li class="dropdown-item"><a href="/cicd/zh/isKcount/3/" class="nav-link" aria-label="è¿ç»´ç¬”è®°"><span class="icon iconfont icon-linux"></span>è¿ç»´ç¬”è®°<!----></a></li><li class="dropdown-item"><a href="/cicd/zh/isKcount/4/" class="nav-link" aria-label="åç«¯å¼€å‘ç¬”è®°"><span class="icon iconfont icon-note"></span>åç«¯å¼€å‘ç¬”è®°<!----></a></li><li class="dropdown-item"><a href="/cicd/zh/isKcount/5/" class="nav-link" aria-label="å‰ç«¯å¼€å‘ç¬”è®°"><span class="icon iconfont icon-like"></span>å‰ç«¯å¼€å‘ç¬”è®°<!----></a></li><li class="dropdown-item"><a href="/cicd/zh/isKcount/6/" class="nav-link" aria-label="ä¸­é—´ä»¶æœåŠ¡ç¬”è®°"><span class="icon iconfont icon-api"></span>ä¸­é—´ä»¶æœåŠ¡ç¬”è®°<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="Devops"><span class="title"><span class="icon iconfont icon-select"></span>Devops</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/cicd/zh/pip/git/" class="nav-link" aria-label="Gitå¼€å‘æ‰‹å†Œ"><span class="icon iconfont icon-git"></span>Gitå¼€å‘æ‰‹å†Œ<!----></a></li><li class="dropdown-item"><a href="/cicd/zh/pip/ci/" class="nav-link" aria-label="CICD"><span class="icon iconfont icon-ci"></span>CICD<!----></a></li><li class="dropdown-item"><a href="/cicd/zh/pip/istio/" class="nav-link" aria-label="Istio"><span class="icon iconfont icon-material"></span>Istio<!----></a></li><li class="dropdown-item"><a href="/cicd/zh/pip/operator/" class="nav-link" aria-label="Operator"><span class="icon iconfont icon-proxy"></span>Operator<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="https://wallhaven.cc/" rel="noopener noreferrer" target="_blank" aria-label="Wallhaven" class="nav-link"><span class="icon iconfont icon-autumn"></span>Wallhaven<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/vuepress-theme-hope/vuepress-theme-hope" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button class="outlook-button" tabindex="-1" ariahidden="true"><svg xmlns="http://www.w3.org/2000/svg" class="icon outlook-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="outlook icon"><path d="M224 800c0 9.6 3.2 44.8 6.4 54.4 6.4 48-48 76.8-48 76.8s80 41.6 147.2 0 134.4-134.4 38.4-195.2c-22.4-12.8-41.6-19.2-57.6-19.2C259.2 716.8 227.2 761.6 224 800zM560 675.2l-32 51.2c-51.2 51.2-83.2 32-83.2 32 25.6 67.2 0 112-12.8 128 25.6 6.4 51.2 9.6 80 9.6 54.4 0 102.4-9.6 150.4-32l0 0c3.2 0 3.2-3.2 3.2-3.2 22.4-16 12.8-35.2 6.4-44.8-9.6-12.8-12.8-25.6-12.8-41.6 0-54.4 60.8-99.2 137.6-99.2 6.4 0 12.8 0 22.4 0 12.8 0 38.4 9.6 48-25.6 0-3.2 0-3.2 3.2-6.4 0-3.2 3.2-6.4 3.2-6.4 6.4-16 6.4-16 6.4-19.2 9.6-35.2 16-73.6 16-115.2 0-105.6-41.6-198.4-108.8-268.8C704 396.8 560 675.2 560 675.2zM224 419.2c0-28.8 22.4-51.2 51.2-51.2 28.8 0 51.2 22.4 51.2 51.2 0 28.8-22.4 51.2-51.2 51.2C246.4 470.4 224 448 224 419.2zM320 284.8c0-22.4 19.2-41.6 41.6-41.6 22.4 0 41.6 19.2 41.6 41.6 0 22.4-19.2 41.6-41.6 41.6C339.2 326.4 320 307.2 320 284.8zM457.6 208c0-12.8 12.8-25.6 25.6-25.6 12.8 0 25.6 12.8 25.6 25.6 0 12.8-12.8 25.6-25.6 25.6C470.4 233.6 457.6 220.8 457.6 208zM128 505.6C128 592 153.6 672 201.6 736c28.8-60.8 112-60.8 124.8-60.8-16-51.2 16-99.2 16-99.2l316.8-422.4c-48-19.2-99.2-32-150.4-32C297.6 118.4 128 291.2 128 505.6zM764.8 86.4c-22.4 19.2-390.4 518.4-390.4 518.4-22.4 28.8-12.8 76.8 22.4 99.2l9.6 6.4c35.2 22.4 80 12.8 99.2-25.6 0 0 6.4-12.8 9.6-19.2 54.4-105.6 275.2-524.8 288-553.6 6.4-19.2-3.2-32-19.2-32C777.6 76.8 771.2 80 764.8 86.4z"></path></svg><div class="outlook-dropdown"><!----></div></button></div><form class="search-box" role="search"><input type="search" placeholder="æœç´¢" autocomplete="off" spellcheck="false" value><!----></form><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/cicd/zh/isKcount/" class="nav-link sidebar-link sidebar-page" aria-label="æŒ‡å—"><span class="icon iconfont icon-creative"></span>æŒ‡å—<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-ability"></span><span class="title">å­¦ä¹ è·¯çº¿è§„åˆ’</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-relation"></span><span class="title">è€ƒè¯</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-linux"></span><span class="title">è¿ç»´ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-note"></span><span class="title">åç«¯å¼€å‘ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-like"></span><span class="title">å‰ç«¯å¼€å‘ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li><li><section class="sidebar-group"><button class="sidebar-heading clickable"><span class="icon iconfont icon-api"></span><span class="title">ä¸­é—´ä»¶æœåŠ¡ç¬”è®°</span><span class="arrow right"></span></button><!----></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->Kubernetes é«˜çº§è¿ç»´</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://iskcount.github.io" target="_blank" rel="noopener noreferrer">isKcount</a></span><span property="author" content="isKcount"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022å¹´1æœˆ22æ—¥</span><meta property="datePublished" content="2022-01-22T12:12:13.000Z"></span><!----><!----><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 31 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT31M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#ä½¿ç”¨kubeadmè¿›è¡Œè¯ä¹¦ç®¡ç†" class="router-link-active router-link-exact-active toc-link level2">ä½¿ç”¨kubeadmè¿›è¡Œè¯ä¹¦ç®¡ç†</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#ä½¿ç”¨è‡ªå®šä¹‰çš„è¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">ä½¿ç”¨è‡ªå®šä¹‰çš„è¯ä¹¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#å¤–éƒ¨-ca-æ¨¡å¼" class="router-link-active router-link-exact-active toc-link level3">å¤–éƒ¨ CA æ¨¡å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ" class="router-link-active router-link-exact-active toc-link level3">æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#è‡ªåŠ¨æ›´æ–°è¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">è‡ªåŠ¨æ›´æ–°è¯ä¹¦</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#æ‰‹åŠ¨æ›´æ–°è¯ä¹¦" class="router-link-active router-link-exact-active toc-link level3">æ‰‹åŠ¨æ›´æ–°è¯ä¹¦</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#è¯ä¹¦" class="router-link-active router-link-exact-active toc-link level2">è¯ä¹¦</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#cfsslæ–¹å¼" class="router-link-active router-link-exact-active toc-link level3">cfsslæ–¹å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#easyrsaæ–¹å¼" class="router-link-active router-link-exact-active toc-link level3">easyrsaæ–¹å¼</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#opensslæ–¹å¼" class="router-link-active router-link-exact-active toc-link level3">opensslæ–¹å¼</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#å¥åº·æ£€æŸ¥" class="router-link-active router-link-exact-active toc-link level2">å¥åº·æ£€æŸ¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#é…ç½®å­˜æ´»ã€å°±ç»ªå’Œå¯åŠ¨æ¢æµ‹å™¨" class="router-link-active router-link-exact-active toc-link level2">é…ç½®å­˜æ´»ã€å°±ç»ªå’Œå¯åŠ¨æ¢æµ‹å™¨</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#å®šä¹‰å­˜æ´»å‘½ä»¤" class="router-link-active router-link-exact-active toc-link level3">å®šä¹‰å­˜æ´»å‘½ä»¤</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#å®šä¹‰ä¸€ä¸ªå­˜æ´»æ€httpè¯·æ±‚æ¥å£" class="router-link-active router-link-exact-active toc-link level2">å®šä¹‰ä¸€ä¸ªå­˜æ´»æ€HTTPè¯·æ±‚æ¥å£</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#å®šä¹‰httpè¯·æ±‚æ¥å£" class="router-link-active router-link-exact-active toc-link level3">å®šä¹‰HTTPè¯·æ±‚æ¥å£</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#å®šä¹‰tcpçš„å­˜æ´»æ¢æµ‹" class="router-link-active router-link-exact-active toc-link level2">å®šä¹‰TCPçš„å­˜æ´»æ¢æµ‹</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#å®šä¹‰tcpæ¢é’ˆ" class="router-link-active router-link-exact-active toc-link level3">å®šä¹‰TCPæ¢é’ˆ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#å®šä¹‰å°±ç»ªæ¢æµ‹å™¨" class="router-link-active router-link-exact-active toc-link level2">å®šä¹‰å°±ç»ªæ¢æµ‹å™¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#é…ç½®æ¢æµ‹å™¨" class="router-link-active router-link-exact-active toc-link level2">é…ç½®æ¢æµ‹å™¨</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#http-æ¢æµ‹" class="router-link-active router-link-exact-active toc-link level3">HTTP æ¢æµ‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#tcp-æ¢æµ‹" class="router-link-active router-link-exact-active toc-link level3">TCP æ¢æµ‹</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#ä½¿ç”¨rbacé‰´æƒ" class="router-link-active router-link-exact-active toc-link level2">ä½¿ç”¨RBACé‰´æƒ</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#api-å¯¹è±¡" class="router-link-active router-link-exact-active toc-link level3">API å¯¹è±¡</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#roleå’Œclusterrole" class="router-link-active router-link-exact-active toc-link level3">Roleå’ŒClusterRole</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#roleçš„ç¤ºä¾‹" class="router-link-active router-link-exact-active toc-link level3">Roleçš„ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#clusterroleç¤ºä¾‹" class="router-link-active router-link-exact-active toc-link level3">ClusterRoleç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#rolebindingå’Œclusterrolebinding" class="router-link-active router-link-exact-active toc-link level3">RoleBindingå’ŒClusterRoleBinding</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#rolebinding-ç¤ºä¾‹" class="router-link-active router-link-exact-active toc-link level3">RoleBinding ç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#clusterrolebindingç¤ºä¾‹" class="router-link-active router-link-exact-active toc-link level3">ClusterRoleBindingç¤ºä¾‹</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#èšåˆçš„-clusterrole" class="router-link-active router-link-exact-active toc-link level3">èšåˆçš„ ClusterRole</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#é¢å‘ç”¨æˆ·çš„è§’è‰²" class="router-link-active router-link-exact-active toc-link level3">é¢å‘ç”¨æˆ·çš„è§’è‰²</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#podçš„å®‰å…¨ç­–ç•¥" class="router-link-active router-link-exact-active toc-link level2">Podçš„å®‰å…¨ç­–ç•¥</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#ä»€ä¹ˆæ˜¯podå®‰å…¨ç­–ç•¥" class="router-link-active router-link-exact-active toc-link level3">ä»€ä¹ˆæ˜¯Podå®‰å…¨ç­–ç•¥ï¼Ÿ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#å¯ç”¨podå®‰å…¨ç­–ç•¥" class="router-link-active router-link-exact-active toc-link level3">å¯ç”¨Podå®‰å…¨ç­–ç•¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#æˆæƒç­–ç•¥" class="router-link-active router-link-exact-active toc-link level3">æˆæƒç­–ç•¥</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#é…ç½®" class="router-link-active router-link-exact-active toc-link level3">é…ç½®</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#åˆ›å»ºä¸€ä¸ªç­–ç•¥å’Œä¸€ä¸ªpod" class="router-link-active router-link-exact-active toc-link level3">åˆ›å»ºä¸€ä¸ªç­–ç•¥å’Œä¸€ä¸ªPod</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#å‘½åç©ºé—´ä¸‹podé…é¢" class="router-link-active router-link-exact-active toc-link level2">å‘½åç©ºé—´ä¸‹Podé…é¢</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#åˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´" class="router-link-active router-link-exact-active toc-link level3">åˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#åˆ›å»ºresourcequota" class="router-link-active router-link-exact-active toc-link level3">åˆ›å»ºResourceQuota</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#éªŒè¯è¯¥èµ„æºé™åˆ¶" class="router-link-active router-link-exact-active toc-link level3">éªŒè¯è¯¥èµ„æºé™åˆ¶</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#æ¸…ç†" class="router-link-active router-link-exact-active toc-link level3">æ¸…ç†</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#é…ç½®apiå¯¹è±¡é…é¢" class="router-link-active router-link-exact-active toc-link level2">é…ç½®APIå¯¹è±¡é…é¢</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#åˆ›å»ºå‘½åç©ºé—´" class="router-link-active router-link-exact-active toc-link level3">åˆ›å»ºå‘½åç©ºé—´</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#åˆ›å»ºresourcequota-1" class="router-link-active router-link-exact-active toc-link level3">åˆ›å»ºResourceQuota</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#åˆ›å»ºpersistentvolumeclaim" class="router-link-active router-link-exact-active toc-link level3">åˆ›å»ºPersistentVolumeClaim</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/cicd/zh/isKcount/2/CKA/14.%E9%AB%98%E7%BA%A7%E8%BF%90%E7%BB%B4.html#å°è¯•åˆ›å»ºç¬¬äºŒä¸ªpersistentvolumeclaim" class="router-link-active router-link-exact-active toc-link level3">å°è¯•åˆ›å»ºç¬¬äºŒä¸ªPersistentVolumeClaim</a></li><!----><!--]--></ul><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="kubernetesé«˜çº§è¿ç»´" tabindex="-1"><a class="header-anchor" href="#kubernetesé«˜çº§è¿ç»´" aria-hidden="true">#</a> Kubernetesé«˜çº§è¿ç»´</h1><h2 id="ä½¿ç”¨kubeadmè¿›è¡Œè¯ä¹¦ç®¡ç†" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨kubeadmè¿›è¡Œè¯ä¹¦ç®¡ç†" aria-hidden="true">#</a> ä½¿ç”¨kubeadmè¿›è¡Œè¯ä¹¦ç®¡ç†</h2><p>ç”± <a href="https://kubernetes.io/zh/docs/reference/setup-tools/kubeadm/" target="_blank" rel="noopener noreferrer">kubeadm<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ç”Ÿæˆçš„å®¢æˆ·ç«¯è¯ä¹¦åœ¨ 1 å¹´ååˆ°æœŸã€‚ æœ¬é¡µè¯´æ˜å¦‚ä½•ä½¿ç”¨ kubeadm ç®¡ç†è¯ä¹¦ç»­è®¢ã€‚</p><h3 id="ä½¿ç”¨è‡ªå®šä¹‰çš„è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨è‡ªå®šä¹‰çš„è¯ä¹¦" aria-hidden="true">#</a> ä½¿ç”¨è‡ªå®šä¹‰çš„è¯ä¹¦</h3><ul><li>é»˜è®¤æƒ…å†µä¸‹, kubeadm ä¼šç”Ÿæˆè¿è¡Œä¸€ä¸ªé›†ç¾¤æ‰€éœ€çš„å…¨éƒ¨è¯ä¹¦ã€‚ ä½ å¯ä»¥é€šè¿‡æä¾›ä½ è‡ªå·±çš„è¯ä¹¦æ¥æ”¹å˜è¿™ä¸ªè¡Œä¸ºç­–ç•¥ã€‚</li><li>å¦‚æœè¦è¿™æ ·åš, ä½ å¿…é¡»å°†è¯ä¹¦æ–‡ä»¶æ”¾ç½®åœ¨é€šè¿‡ <code>--cert-dir</code> å‘½ä»¤è¡Œå‚æ•°æˆ–è€… kubeadm é…ç½®ä¸­çš„ <code>CertificatesDir</code> é…ç½®é¡¹æŒ‡æ˜çš„ç›®å½•ä¸­ã€‚é»˜è®¤çš„å€¼æ˜¯ <code>/etc/kubernetes/pki</code>ã€‚</li><li>å¦‚æœåœ¨è¿è¡Œ <code>kubeadm init</code> ä¹‹å‰å­˜åœ¨ç»™å®šçš„è¯ä¹¦å’Œç§é’¥å¯¹ï¼Œkubeadm å°†ä¸ä¼šé‡å†™å®ƒä»¬ã€‚ ä¾‹å¦‚ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥å°†ç°æœ‰çš„ CA å¤åˆ¶åˆ° <code>/etc/kubernetes/pki/ca.crt</code> å’Œ <code>/etc/kubernetes/pki/ca.key</code> ä¸­ï¼Œè€Œ kubeadm å°†ä½¿ç”¨æ­¤ CA å¯¹å…¶ä½™è¯ä¹¦è¿›è¡Œç­¾åã€‚</li></ul><h3 id="å¤–éƒ¨-ca-æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#å¤–éƒ¨-ca-æ¨¡å¼" aria-hidden="true">#</a> å¤–éƒ¨ CA æ¨¡å¼</h3><ul><li>åªæä¾›äº† <code>ca.crt</code> æ–‡ä»¶ä½†æ˜¯ä¸æä¾› <code>ca.key</code> æ–‡ä»¶ä¹Ÿæ˜¯å¯ä»¥çš„ ï¼ˆè¿™åªå¯¹ CA æ ¹è¯ä¹¦å¯ç”¨ï¼Œå…¶å®ƒè¯ä¹¦ä¸å¯ç”¨ï¼‰ã€‚ å¦‚æœæ‰€æœ‰çš„å…¶å®ƒè¯ä¹¦å’Œ kubeconfig æ–‡ä»¶å·²å°±ç»ªï¼Œkubeadm æ£€æµ‹åˆ°æ»¡è¶³ä»¥ä¸Šæ¡ä»¶å°±ä¼šæ¿€æ´» &quot;å¤–éƒ¨ CA&quot; æ¨¡å¼ã€‚kubeadm å°†ä¼šåœ¨æ²¡æœ‰ CA å¯†é’¥æ–‡ä»¶çš„æƒ…å†µä¸‹ç»§ç»­æ‰§è¡Œã€‚</li><li>å¦åˆ™, kubeadm å°†ç‹¬ç«‹è¿è¡Œ controller-managerï¼Œé™„åŠ ä¸€ä¸ª <code>--controllers=csrsigner</code> çš„å‚æ•°ï¼Œå¹¶ä¸”æŒ‡æ˜ CA è¯ä¹¦å’Œå¯†é’¥ã€‚</li><li><a href="https://kubernetes.io/zh/docs/setup/best-practices/certificates/" target="_blank" rel="noopener noreferrer">PKI è¯ä¹¦å’Œè¦æ±‚<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>åŒ…æ‹¬é›†ç¾¤ä½¿ç”¨å¤–éƒ¨ CA çš„è®¾ç½®æŒ‡å—ã€‚</li></ul><h3 id="æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ" tabindex="-1"><a class="header-anchor" href="#æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ" aria-hidden="true">#</a> æ£€æŸ¥è¯ä¹¦æ˜¯å¦è¿‡æœŸ</h3><ul><li>ä½ å¯ä»¥ä½¿ç”¨ <code>check-expiration</code> å­å‘½ä»¤æ¥æ£€æŸ¥è¯ä¹¦ä½•æ—¶è¿‡æœŸ</li><li>è¯¥å‘½ä»¤æ˜¾ç¤º <code>/etc/kubernetes/pki</code> æ–‡ä»¶å¤¹ä¸­çš„å®¢æˆ·ç«¯è¯ä¹¦ä»¥åŠ kubeadmï¼ˆ<code>admin.conf</code>, <code>controller-manager.conf</code> å’Œ <code>scheduler.conf</code>ï¼‰ ä½¿ç”¨çš„ KUBECONFIG æ–‡ä»¶ä¸­åµŒå…¥çš„å®¢æˆ·ç«¯è¯ä¹¦çš„åˆ°æœŸæ—¶é—´/å‰©ä½™æ—¶é—´ã€‚</li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubeadm certs check-expiration</span>
<span class="token punctuation">[</span>check-expiration<span class="token punctuation">]</span> Reading configuration from the cluster<span class="token punctuation">..</span>.
<span class="token punctuation">[</span>check-expiration<span class="token punctuation">]</span> FYI: You can <span class="token function">look</span> at this config <span class="token function">file</span> with <span class="token string">&#39;kubectl -n kube-system get cm kubeadm-config -o yaml&#39;</span>

CERTIFICATE                EXPIRES                  RESIDUAL TIME   CERTIFICATE AUTHORITY   EXTERNALLY MANAGED
admin.conf                 Nov <span class="token number">23</span>, <span class="token number">2022</span> <span class="token number">18</span>:55 UTC   363d                                    no      
apiserver                  Nov <span class="token number">23</span>, <span class="token number">2022</span> <span class="token number">18</span>:55 UTC   363d            ca                      no      
apiserver-etcd-client      Nov <span class="token number">23</span>, <span class="token number">2022</span> <span class="token number">18</span>:55 UTC   363d            etcd-ca                 no      
apiserver-kubelet-client   Nov <span class="token number">23</span>, <span class="token number">2022</span> <span class="token number">18</span>:55 UTC   363d            ca                      no      
controller-manager.conf    Nov <span class="token number">23</span>, <span class="token number">2022</span> <span class="token number">18</span>:55 UTC   363d                                    no      
etcd-healthcheck-client    Nov <span class="token number">23</span>, <span class="token number">2022</span> <span class="token number">18</span>:55 UTC   363d            etcd-ca                 no      
etcd-peer                  Nov <span class="token number">23</span>, <span class="token number">2022</span> <span class="token number">18</span>:55 UTC   363d            etcd-ca                 no      
etcd-server                Nov <span class="token number">23</span>, <span class="token number">2022</span> <span class="token number">18</span>:55 UTC   363d            etcd-ca                 no      
front-proxy-client         Nov <span class="token number">23</span>, <span class="token number">2022</span> <span class="token number">18</span>:55 UTC   363d            front-proxy-ca          no      
scheduler.conf             Nov <span class="token number">23</span>, <span class="token number">2022</span> <span class="token number">18</span>:55 UTC   363d                                    no      

CERTIFICATE AUTHORITY   EXPIRES                  RESIDUAL TIME   EXTERNALLY MANAGED
ca                      Nov <span class="token number">21</span>, <span class="token number">2031</span> <span class="token number">18</span>:55 UTC   9y              no      
etcd-ca                 Nov <span class="token number">21</span>, <span class="token number">2031</span> <span class="token number">18</span>:55 UTC   9y              no      
front-proxy-ca          Nov <span class="token number">21</span>, <span class="token number">2031</span> <span class="token number">18</span>:55 UTC   9y              no      
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="è‡ªåŠ¨æ›´æ–°è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#è‡ªåŠ¨æ›´æ–°è¯ä¹¦" aria-hidden="true">#</a> è‡ªåŠ¨æ›´æ–°è¯ä¹¦</h3><ul><li><code>kubeadm</code> ä¼šåœ¨æ§åˆ¶é¢ <a href="https://kubernetes.io/zh/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/" target="_blank" rel="noopener noreferrer">å‡çº§<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> çš„æ—¶å€™æ›´æ–°æ‰€æœ‰è¯ä¹¦ã€‚</li><li>è¿™ä¸ªåŠŸèƒ½æ—¨åœ¨è§£å†³æœ€ç®€å•çš„ç”¨ä¾‹ï¼›å¦‚æœä½ å¯¹æ­¤ç±»è¯ä¹¦çš„æ›´æ–°æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼Œå¹¶ä¸”å®šæœŸæ‰§è¡ŒKubernetesç‰ˆæœ¬å‡çº§ï¼ˆæ¯æ¬¡å‡çº§ä¹‹é—´çš„é—´éš”æ—¶é—´å°‘äº1å¹´ï¼‰ï¼Œkubeadmå°†ç¡®ä¿ä½ çš„é›†ç¾¤ä¿æŒæœ€æ–°çŠ¶æ€å¹¶ä¿æŒåˆç†çš„å®‰å…¨æ€§ã€‚</li><li><strong>è¯´æ˜ï¼š</strong> æœ€ä½³çš„åšæ³•æ˜¯ç»å¸¸å‡çº§é›†ç¾¤ä»¥ç¡®ä¿å®‰å…¨ã€‚</li><li>å¦‚æœä½ å¯¹è¯ä¹¦æ›´æ–°æœ‰æ›´å¤æ‚çš„éœ€æ±‚ï¼Œåˆ™å¯é€šè¿‡å°† <code>--certificate-renewal=false</code> ä¼ é€’ç»™ <code>kubeadm upgrade apply</code> æˆ–è€… <code>kubeadm upgrade node</code>ï¼Œä»è€Œé€‰æ‹©ä¸é‡‡ç”¨é»˜è®¤è¡Œä¸ºã€‚</li></ul><h3 id="æ‰‹åŠ¨æ›´æ–°è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#æ‰‹åŠ¨æ›´æ–°è¯ä¹¦" aria-hidden="true">#</a> æ‰‹åŠ¨æ›´æ–°è¯ä¹¦</h3><ul><li><p>ä½ èƒ½éšæ—¶é€šè¿‡ <code>kubeadm certs renew</code> å‘½ä»¤æ‰‹åŠ¨æ›´æ–°ä½ çš„è¯ä¹¦ã€‚</p></li><li><p>æ­¤å‘½ä»¤ç”¨ CA ï¼ˆæˆ–è€… front-proxy-CA ï¼‰è¯ä¹¦å’Œå­˜å‚¨åœ¨ <code>/etc/kubernetes/pki</code> ä¸­çš„å¯†é’¥æ‰§è¡Œæ›´æ–°ã€‚</p></li><li><p>æ‰§è¡Œå®Œæ­¤å‘½ä»¤ä¹‹åä½ éœ€è¦é‡å¯æ§åˆ¶é¢ Podsã€‚å› ä¸ºåŠ¨æ€è¯ä¹¦é‡è½½ç›®å‰è¿˜ä¸è¢«æ‰€æœ‰ç»„ä»¶å’Œè¯ä¹¦æ”¯æŒï¼Œæ‰€æœ‰è¿™é¡¹æ“ä½œæ˜¯å¿…é¡»çš„ã€‚ <a href="https://kubernetes.io/zh/docs/tasks/configure-pod-container/static-pod/" target="_blank" rel="noopener noreferrer">é™æ€ Pods<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æ˜¯è¢«æœ¬åœ° kubelet è€Œä¸æ˜¯ API Server ç®¡ç†ï¼Œ æ‰€ä»¥ kubectl ä¸èƒ½ç”¨æ¥åˆ é™¤æˆ–é‡å¯ä»–ä»¬ã€‚ è¦é‡å¯é™æ€ Pod ä½ å¯ä»¥ä¸´æ—¶å°†æ¸…å•æ–‡ä»¶ä» <code>/etc/kubernetes/manifests/</code> ç§»é™¤å¹¶ç­‰å¾… 20 ç§’ ï¼ˆå‚è€ƒ <a href="https://kubernetes.io/docs/reference/config-api/kubelet-config.v1beta1/" target="_blank" rel="noopener noreferrer">KubeletConfiguration ç»“æ„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä¸­çš„<code>fileCheckFrequency</code> å€¼ï¼‰ã€‚ å¦‚æœ Pod ä¸åœ¨æ¸…å•ç›®å½•é‡Œï¼Œkubeletå°†ä¼šç»ˆæ­¢å®ƒã€‚ åœ¨å¦ä¸€ä¸ª <code>fileCheckFrequency</code> å‘¨æœŸä¹‹åä½ å¯ä»¥å°†æ–‡ä»¶ç§»å›å»ï¼Œä¸ºäº†ç»„ä»¶å¯ä»¥å®Œæˆ kubelet å°†é‡æ–°åˆ›å»º Pod å’Œè¯ä¹¦æ›´æ–°ã€‚</p></li><li><p><strong>è­¦å‘Šï¼š</strong> å¦‚æœä½ è¿è¡Œäº†ä¸€ä¸ª HA é›†ç¾¤ï¼Œè¿™ä¸ªå‘½ä»¤éœ€è¦åœ¨æ‰€æœ‰æ§åˆ¶é¢æ¿èŠ‚ç‚¹ä¸Šæ‰§è¡Œã€‚</p></li><li><p><strong>è¯´æ˜ï¼š</strong> <code>certs renew</code> ä½¿ç”¨ç°æœ‰çš„è¯ä¹¦ä½œä¸ºå±æ€§ (Common Nameã€Organizationã€SAN ç­‰) çš„æƒå¨æ¥æºï¼Œ è€Œä¸æ˜¯ kubeadm-config ConfigMap ã€‚å¼ºçƒˆå»ºè®®ä½¿å®ƒä»¬ä¿æŒåŒæ­¥ã€‚</p></li><li><p><code>kubeadm certs renew</code>æä¾›ä»¥ä¸‹é€‰é¡¹ï¼š</p><ul><li><p>Kubernetes è¯ä¹¦é€šå¸¸åœ¨ä¸€å¹´ååˆ°æœŸã€‚</p></li><li><p><code>--csr-only</code> å¯ç”¨äºç»è¿‡ä¸€ä¸ªå¤–éƒ¨ CA ç”Ÿæˆçš„è¯ä¹¦ç­¾åè¯·æ±‚æ¥æ›´æ–°è¯ä¹¦ï¼ˆæ— éœ€å®é™…æ›¿æ¢æ›´æ–°è¯ä¹¦ï¼‰ã€‚</p></li><li><p>å¯ä»¥æ›´æ–°å•ä¸ªè¯ä¹¦è€Œä¸æ˜¯å…¨éƒ¨è¯ä¹¦ã€‚</p></li></ul></li></ul><h2 id="è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#è¯ä¹¦" aria-hidden="true">#</a> è¯ä¹¦</h2><p>åœ¨ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦è®¤è¯çš„åœºæ™¯ä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡ <code>easyrsa</code>ã€<code>openssl</code> æˆ– <code>cfssl</code> ç­‰å·¥å…·ä»¥æ‰‹å·¥æ–¹å¼ç”Ÿæˆè¯ä¹¦ã€‚</p><h3 id="cfsslæ–¹å¼" tabindex="-1"><a class="header-anchor" href="#cfsslæ–¹å¼" aria-hidden="true">#</a> cfsslæ–¹å¼</h3><ul><li><strong>cfsslä¸‹è½½åœ°å€</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token assign-left variable">VERSION</span><span class="token operator">=</span>R1.2
<span class="token keyword">for</span> <span class="token for-or-select variable">i</span> <span class="token keyword">in</span> <span class="token punctuation">{</span>cfssl,cfssljson,cfssl-certinfo<span class="token punctuation">}</span>
<span class="token keyword">do</span>
<span class="token function">wget</span> https://pkg.cfssl.org/<span class="token variable">${VERSION}</span>/<span class="token variable">${i}</span>_linux-amd64 <span class="token parameter variable">-O</span> /usr/local/bin/<span class="token variable">${i}</span>
<span class="token keyword">done</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>ç”ŸæˆCAé…ç½®æ–‡ä»¶</strong></li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>mkdir ssl &amp;&amp; cd ssl
cfssl print-defaults config &gt; config.json
cfssl print-defaults csr &gt; csr.json
cat &gt; ca-config.json &lt;&lt;EOF
<span class="token punctuation">{</span>
  <span class="token property">&quot;signing&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;default&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;expiry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;87600h&quot;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;profiles&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;kubernetes&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token property">&quot;usages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
            <span class="token string">&quot;signing&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;key encipherment&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;server auth&quot;</span><span class="token punctuation">,</span>
            <span class="token string">&quot;client auth&quot;</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token property">&quot;expiry&quot;</span><span class="token operator">:</span> <span class="token string">&quot;87600h&quot;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>ç”ŸæˆCAç­¾åé…ç½®æ–‡ä»¶</strong></li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>cat &gt; ca-csr.json &lt;&lt; EOF
<span class="token punctuation">{</span>
  <span class="token property">&quot;CN&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kubernetes&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;algo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rsa&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">2048</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;names&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;C&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ST&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Beijing&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;L&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BeiJing&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;O&quot;</span><span class="token operator">:</span> <span class="token string">&quot;k8s&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;OU&quot;</span><span class="token operator">:</span> <span class="token string">&quot;System&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>ç”Ÿæˆç§é’¥å’Œè¯ä¹¦</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>cfssl gencert <span class="token parameter variable">-initca</span> ca-csr.json <span class="token operator">|</span> cfssljson <span class="token parameter variable">-bare</span> ca
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>åˆ›å»ºä¸€ä¸ªç”¨äºç”ŸæˆAPI Serverçš„å¯†é’¥å’Œè¯ä¹¦çš„JSONé…ç½®æ–‡ä»¶</strong></li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>cat &gt; kubernetes-csr.json &lt;&lt;EOF
<span class="token punctuation">{</span>
  <span class="token property">&quot;CN&quot;</span><span class="token operator">:</span> <span class="token string">&quot;kubernetes&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;hosts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;&lt;MASTER_IP&gt;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;&lt;MASTER_CLUSTER_IP&gt;&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;kubernetes&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;kubernetes.default&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;kubernetes.default.svc&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;kubernetes.default.svc.cluster&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;kubernetes.default.svc.cluster.local&quot;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;algo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rsa&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">2048</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;names&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span>
    <span class="token property">&quot;C&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;ST&quot;</span><span class="token operator">:</span> <span class="token string">&quot;Beijing&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;L&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BeiJing&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;O&quot;</span><span class="token operator">:</span> <span class="token string">&quot;k8s&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;OU&quot;</span><span class="token operator">:</span> <span class="token string">&quot;System&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span> 
EOF
#è¯¥æ–‡ä»¶éœ€è¦åŒ…å«æ‰€æœ‰ä½¿ç”¨è¯¥è¯ä¹¦çš„ipå’ŒåŸŸååˆ—è¡¨ï¼ŒåŒ…æ‹¬etcdé›†ç¾¤ã€kubernetes masteré›†ç¾¤ã€ä»¥åŠapiserver é›†ç¾¤å†…éƒ¨cluster ipã€‚
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>ç”Ÿæˆ kubernetes è¯ä¹¦å’Œç§é’¥</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>cfssl gencert <span class="token parameter variable">-ca</span><span class="token operator">=</span>ca.pem -ca-key<span class="token operator">=</span>ca-key.pem <span class="token parameter variable">-config</span><span class="token operator">=</span>ca-config.json <span class="token parameter variable">-profile</span><span class="token operator">=</span>kubernetes kubernetes-csr.json <span class="token operator">|</span> cfssljson <span class="token parameter variable">-bare</span> kubernetes
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><h6 id="åˆ›å»ºadminè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºadminè¯ä¹¦" aria-hidden="true">#</a> åˆ›å»ºadminè¯ä¹¦</h6></li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>cat &gt; admin-csr.json &lt;&lt;EOF
<span class="token punctuation">{</span>
  <span class="token property">&quot;CN&quot;</span><span class="token operator">:</span> <span class="token string">&quot;admin&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;hosts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;algo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rsa&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">2048</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;names&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;C&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;ST&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BeiJing&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;L&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BeiJing&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;O&quot;</span><span class="token operator">:</span> <span class="token string">&quot;system:masters&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;OU&quot;</span><span class="token operator">:</span> <span class="token string">&quot;System&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
EOF

cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes admin-csr.json | cfssljson -bare admin
# è¯ä¹¦Oé…ç½®ä¸ºsystem<span class="token operator">:</span>masters åœ¨é›†ç¾¤å†…éƒ¨cluster-adminçš„clusterrolebindingå°†system<span class="token operator">:</span>mastersç»„å’Œcluster-admin clusterroleç»‘å®šåœ¨ä¸€èµ·
Copy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><h6 id="åˆ›å»ºkube-proxyè¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºkube-proxyè¯ä¹¦" aria-hidden="true">#</a> åˆ›å»ºkube-proxyè¯ä¹¦</h6></li></ul><div class="language-json ext-json line-numbers-mode"><pre class="language-json"><code>cat &gt; kube-proxy-csr.json &lt;&lt; EOF
<span class="token punctuation">{</span>
  <span class="token property">&quot;CN&quot;</span><span class="token operator">:</span> <span class="token string">&quot;system:kube-proxy&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;hosts&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;algo&quot;</span><span class="token operator">:</span> <span class="token string">&quot;rsa&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;size&quot;</span><span class="token operator">:</span> <span class="token number">2048</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;names&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      <span class="token property">&quot;C&quot;</span><span class="token operator">:</span> <span class="token string">&quot;CN&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;ST&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BeiJing&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;L&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BeiJing&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;O&quot;</span><span class="token operator">:</span> <span class="token string">&quot;k8s&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;OU&quot;</span><span class="token operator">:</span> <span class="token string">&quot;System&quot;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
EOF
cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes  kube-proxy-csr.json | cfssljson -bare kube-proxy
# è¯¥è¯ä¹¦ç”¨æˆ·åä¸ºsystem<span class="token operator">:</span>kube-proxyï¼Œé¢„å®šä¹‰çš„system<span class="token operator">:</span>node-proxier clusterrolebindingså°† system<span class="token operator">:</span>kube-proxyç”¨æˆ·å’Œsystem<span class="token operator">:</span>node-proxierè§’è‰²ç»‘å®šåœ¨ä¸€èµ·
Copy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><h6 id="æ ¡éªŒè¯ä¹¦ä¿¡æ¯" tabindex="-1"><a class="header-anchor" href="#æ ¡éªŒè¯ä¹¦ä¿¡æ¯" aria-hidden="true">#</a> æ ¡éªŒè¯ä¹¦ä¿¡æ¯</h6></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>cfssl-certinfo <span class="token parameter variable">-cert</span> kubernetes.pem
openssl x509  <span class="token parameter variable">-noout</span> <span class="token parameter variable">-text</span> <span class="token parameter variable">-in</span>  kubernetes.pem
Copy
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><h6 id="æ‹·è´è¯ä¹¦" tabindex="-1"><a class="header-anchor" href="#æ‹·è´è¯ä¹¦" aria-hidden="true">#</a> æ‹·è´è¯ä¹¦</h6></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/kubernetes/ssl/ <span class="token operator">&amp;&amp;</span> <span class="token function">cp</span> *.pem /etc/kubernetes/ssl/
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="easyrsaæ–¹å¼" tabindex="-1"><a class="header-anchor" href="#easyrsaæ–¹å¼" aria-hidden="true">#</a> easyrsaæ–¹å¼</h3><p><strong>easyrsa</strong> æ”¯æŒä»¥æ‰‹å·¥æ–¹å¼ä¸ºä½ çš„é›†ç¾¤ç”Ÿæˆè¯ä¹¦ã€‚</p><ul><li><strong><code>ä¸‹è½½ã€è§£å‹ã€åˆå§‹åŒ–æ‰“è¿‡è¡¥ä¸çš„ easyrsa3ã€‚</code></strong></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@master pod]# curl -O http://172.25.253.144/file/tranning/easy-rsa.tar.gz
[root@master pod]# tar xzf easy-rsa.tar.gz
[root@master pod]# cd easy-rsa-master/easyrsa3
[root@master easyrsa3]# ./easyrsa init-pki
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>ç”Ÿæˆæ–°çš„è¯ä¹¦é¢å‘æœºæ„ï¼ˆCAï¼‰ã€‚å‚æ•° <code>--batch</code> ç”¨äºè®¾ç½®è‡ªåŠ¨æ¨¡å¼ï¼› å‚æ•° <code>--req-cn</code> ç”¨äºè®¾ç½®æ–°çš„æ ¹è¯ä¹¦çš„é€šç”¨åç§°ï¼ˆCNï¼‰ã€‚</strong></li></ul><div class="language-text ext-text line-numbers-mode"><pre class="language-text"><code>[root@master easyrsa3]# ./easyrsa --batch &quot;--req-cn=172.25.253.3@`date +%s`&quot; build-ca nopass
Generating a 2048 bit RSA private key
...+++
..........+++
writing new private key to &#39;/root/pod/easy-rsa-master/easyrsa3/pki/private/ca.key&#39;
-----
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>ç”ŸæˆæœåŠ¡å™¨è¯ä¹¦å’Œç§˜é’¥ã€‚ å‚æ•° <code>--subject-alt-name</code> è®¾ç½®APIæœåŠ¡å™¨çš„IPå’Œ DNS åç§°ã€‚ <code>MASTER_CLUSTER_IP</code> ç”¨äº API æœåŠ¡å™¨å’Œæ§åˆ¶ç®¡ç†å™¨ï¼Œé€šå¸¸å– CIDR çš„ç¬¬ä¸€ä¸ª IPï¼Œç”± <code>--service-cluster-ip-range</code> çš„å‚æ•°æä¾›ã€‚ å‚æ•° <code>--days</code> ç”¨äºè®¾ç½®è¯ä¹¦çš„è¿‡æœŸæ—¶é—´ã€‚ ä¸‹é¢çš„ç¤ºä¾‹å‡å®šä½ çš„é»˜è®¤ DNS åŸŸåä¸º <code>cluster.local</code>ã€‚</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master easyrsa3<span class="token punctuation">]</span><span class="token comment"># ./easyrsa --subject-alt-name=&quot;IP:172.25.253.3,&quot;\</span>
<span class="token operator">&gt;</span> <span class="token string">&quot;IP:10.96.0.1,&quot;</span><span class="token punctuation">\</span>
<span class="token operator">&gt;</span> <span class="token string">&quot;DNS:kubernetes,&quot;</span><span class="token punctuation">\</span>
<span class="token operator">&gt;</span> <span class="token string">&quot;DNS:kubernetes.default,&quot;</span><span class="token punctuation">\</span>
<span class="token operator">&gt;</span> <span class="token string">&quot;DNS:kubernetes.default.svc,&quot;</span><span class="token punctuation">\</span>
<span class="token operator">&gt;</span> <span class="token string">&quot;DNS:kubernetes.default.svc.cluster,&quot;</span><span class="token punctuation">\</span>
<span class="token operator">&gt;</span> <span class="token string">&quot;DNS:kubernetes.default.svc.cluster.local&quot;</span> <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> <span class="token parameter variable">--days</span><span class="token operator">=</span><span class="token number">10000</span> <span class="token punctuation">\</span>
<span class="token operator">&gt;</span> build-server-full server nopass

Generating a <span class="token number">2048</span> bit RSA private key
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.+++
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.+++
writing new private key to <span class="token string">&#39;/root/pod/easy-rsa-master/easyrsa3/pki/private/server.key&#39;</span>
-----
Using configuration from /root/pod/easy-rsa-master/easyrsa3/openssl-1.0.cnf   <span class="token comment">#è¿™é‡Œæœ‰å‘Šè¯‰ä½ çš„è¯ä¹¦è·¯å¾„</span>
Check that the request matches the signature
Signature ok
The Subject<span class="token string">&#39;s Distinguished Name is as follows
commonName            :ASN.1 12:&#39;</span>server&#39;
Certificate is to be certified <span class="token keyword">until</span> Apr <span class="token number">11</span> <span class="token number">20</span>:46:17 <span class="token number">2049</span> GMT <span class="token punctuation">(</span><span class="token number">10000</span> days<span class="token punctuation">)</span>

Write out database with <span class="token number">1</span> new entries
Data Base Updated
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æ‹·è´æ–‡ä»¶ <code>pki/ca.crt</code>ã€<code>pki/issued/server.crt</code> å’Œ <code>pki/private/server.key</code> åˆ°ä½ çš„ç›®å½•ä¸­ã€‚</strong></li><li><strong>åœ¨ API æœåŠ¡å™¨çš„å¯åŠ¨å‚æ•°ä¸­æ·»åŠ ä»¥ä¸‹å‚æ•°ï¼š</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>--client-ca-file<span class="token operator">=</span>/yourdirectory/ca.crt
--tls-cert-file<span class="token operator">=</span>/yourdirectory/server.crt
--tls-private-key-file<span class="token operator">=</span>/yourdirectory/server.key
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>adminè¯ä¹¦</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl genrsa -out admin.key 2048</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl req -new -key admin.key -out admin.csr -subj &quot;/O=system:masters/CN=dmin&quot;</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl x509 -req -set_serial $(date +%s%N) -in admin.csr -CA ca.crt -CAkey ca.key -out admin.crt -days 365 -extensions v3_req -extfile req.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="opensslæ–¹å¼" tabindex="-1"><a class="header-anchor" href="#opensslæ–¹å¼" aria-hidden="true">#</a> opensslæ–¹å¼</h3><p><strong>openssl</strong> æ”¯æŒä»¥æ‰‹å·¥æ–¹å¼ä¸ºä½ çš„é›†ç¾¤ç”Ÿæˆè¯ä¹¦ã€‚</p><ul><li><strong>ç”Ÿæˆä¸€ä¸ª 2048 ä½çš„ ca.key æ–‡ä»¶</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl genrsa -out ca.key 2048</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>åœ¨ca.keyæ–‡ä»¶çš„åŸºç¡€ä¸Šï¼Œç”Ÿæˆca.crtæ–‡ä»¶ï¼ˆç”¨å‚æ•° -days è®¾ç½®è¯ä¹¦æœ‰æ•ˆæœŸï¼‰</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl req -x509 -new -nodes -key ca.key -subj &quot;/CN=${MASTER_IP}&quot; -days 10000 -out ca.crt </span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>ç”Ÿæˆä¸€ä¸ª2048ä½çš„server.keyæ–‡ä»¶ï¼š</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl genrsa -out server.key 2048</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>åˆ›å»ºä¸€ä¸ªç”¨äºç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼ˆCSRï¼‰çš„é…ç½®æ–‡ä»¶ã€‚ ä¿å­˜æ–‡ä»¶ï¼ˆä¾‹å¦‚ï¼š<code>csr.conf</code>ï¼‰å‰ï¼Œè®°å¾—ç”¨çœŸå®å€¼æ›¿æ¢æ‰å°–æ‹¬å·ä¸­çš„å€¼ï¼ˆä¾‹å¦‚ï¼š<code>&lt;MASTER_IP&gt;</code>ï¼‰ã€‚ æ³¨æ„ï¼š<code>MASTER_CLUSTER_IP</code> å°±åƒå‰ä¸€å°èŠ‚æ‰€è¿°ï¼Œå®ƒçš„å€¼æ˜¯ API æœåŠ¡å™¨çš„æœåŠ¡é›†ç¾¤ IPã€‚ ä¸‹é¢çš„ä¾‹å­å‡å®šä½ çš„é»˜è®¤ DNS åŸŸåä¸º <code>cluster.local</code>ã€‚</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat csr.conf </span>

<span class="token punctuation">[</span> req <span class="token punctuation">]</span>
default_bits <span class="token operator">=</span> <span class="token number">2048</span>
prompt <span class="token operator">=</span> no
default_md <span class="token operator">=</span> sha256
req_extensions <span class="token operator">=</span> req_ext
distinguished_name <span class="token operator">=</span> dn

<span class="token punctuation">[</span> dn <span class="token punctuation">]</span>
C <span class="token operator">=</span> <span class="token operator">&lt;</span>country<span class="token operator">&gt;</span>
ST <span class="token operator">=</span> <span class="token operator">&lt;</span>state<span class="token operator">&gt;</span>
L <span class="token operator">=</span> <span class="token operator">&lt;</span>city<span class="token operator">&gt;</span>
O <span class="token operator">=</span> <span class="token operator">&lt;</span>organization<span class="token operator">&gt;</span>
OU <span class="token operator">=</span> <span class="token operator">&lt;</span>organization unit<span class="token operator">&gt;</span>
CN <span class="token operator">=</span> <span class="token number">172.25</span>.253.3

<span class="token punctuation">[</span> req_ext <span class="token punctuation">]</span>
subjectAltName <span class="token operator">=</span> @alt_names

<span class="token punctuation">[</span> alt_names <span class="token punctuation">]</span>
DNS.1 <span class="token operator">=</span> kubernetes
DNS.2 <span class="token operator">=</span> kubernetes.default
DNS.3 <span class="token operator">=</span> kubernetes.default.svc
DNS.4 <span class="token operator">=</span> kubernetes.default.svc.cluster
DNS.5 <span class="token operator">=</span> kubernetes.default.svc.cluster.local
IP.1 <span class="token operator">=</span> <span class="token number">172.25</span>.253.3
IP.2 <span class="token operator">=</span> <span class="token number">10.96</span>.0.1

<span class="token punctuation">[</span> v3_ext <span class="token punctuation">]</span>
<span class="token assign-left variable">authorityKeyIdentifier</span><span class="token operator">=</span>keyid,issuer:always
<span class="token assign-left variable">basicConstraints</span><span class="token operator">=</span>CA:FALSE
<span class="token assign-left variable">keyUsage</span><span class="token operator">=</span>keyEncipherment,dataEncipherment
<span class="token assign-left variable">extendedKeyUsage</span><span class="token operator">=</span>serverAuth,clientAuth
<span class="token assign-left variable">subjectAltName</span><span class="token operator">=</span>@alt_names
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>åŸºäºä¸Šé¢çš„é…ç½®æ–‡ä»¶ç”Ÿæˆè¯ä¹¦ç­¾åè¯·æ±‚ï¼š</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl req -new -key server.key -out server.csr -config csr.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>åŸºäº ca.keyã€ca.key å’Œ server.csr ç­‰ä¸‰ä¸ªæ–‡ä»¶ç”ŸæˆæœåŠ¡ç«¯è¯ä¹¦ï¼š</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl x509 -req -in server.csr -CA ca.crt -CAkey ca.key \</span>
<span class="token parameter variable">-CAcreateserial</span> <span class="token parameter variable">-out</span> server.crt <span class="token parameter variable">-days</span> <span class="token number">10000</span> <span class="token punctuation">\</span>
<span class="token parameter variable">-extensions</span> v3_ext <span class="token parameter variable">-extfile</span> csr.conf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æŸ¥çœ‹è¯ä¹¦ç­¾åè¯·æ±‚ï¼š</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl req  -noout -text -in ./server.csr</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><ul><li><strong>æŸ¥çœ‹è¯ä¹¦ï¼š</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl x509  -noout -text -in ./server.crt</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>adminè¯ä¹¦</strong></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl genrsa -out admin.key 2048</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl req -new -key admin.key -out admin.csr -subj &quot;/O=system:masters/CN=dmin&quot;</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># openssl x509 -req -set_serial $(date +%s%N) -in admin.csr -CA ca.crt -CAkey ca.key -out admin.crt -days 365 -extensions v3_req -extfile req.conf</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å¥åº·æ£€æŸ¥" tabindex="-1"><a class="header-anchor" href="#å¥åº·æ£€æŸ¥" aria-hidden="true">#</a> å¥åº·æ£€æŸ¥</h2><blockquote><h2 id="é…ç½®å­˜æ´»ã€å°±ç»ªå’Œå¯åŠ¨æ¢æµ‹å™¨" tabindex="-1"><a class="header-anchor" href="#é…ç½®å­˜æ´»ã€å°±ç»ªå’Œå¯åŠ¨æ¢æµ‹å™¨" aria-hidden="true">#</a> é…ç½®å­˜æ´»ã€å°±ç»ªå’Œå¯åŠ¨æ¢æµ‹å™¨</h2></blockquote><p><a href="https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kubelet/" target="_blank" rel="noopener noreferrer">kubelet<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä½¿ç”¨å­˜æ´»æ¢æµ‹å™¨æ¥çŸ¥é“ä»€ä¹ˆæ—¶å€™è¦é‡å¯å®¹å™¨ï¼Œå­˜æ´»æ¢æµ‹å™¨å¯ä»¥æ•æ‰åˆ°æ­»é”ï¼ˆåº”ç”¨ç¨‹åºåœ¨è¿è¡Œï¼Œä½†æ˜¯æ— æ³•ç»§ç»­æ‰§è¡Œåé¢çš„æ­¥éª¤ï¼‰ã€‚ è¿™æ ·çš„æƒ…å†µä¸‹é‡å¯å®¹å™¨æœ‰åŠ©äºè®©åº”ç”¨ç¨‹åºåœ¨æœ‰é—®é¢˜çš„æƒ…å†µä¸‹æ›´å¯ç”¨ã€‚</p><p>kubelet ä½¿ç”¨å°±ç»ªæ¢æµ‹å™¨å¯ä»¥çŸ¥é“å®¹å™¨ä»€ä¹ˆæ—¶å€™å‡†å¤‡å¥½äº†å¹¶å¯ä»¥å¼€å§‹æ¥å—è¯·æ±‚æµé‡ï¼Œ å½“ä¸€ä¸ª Pod å†…çš„æ‰€æœ‰å®¹å™¨éƒ½å‡†å¤‡å¥½äº†ï¼Œæ‰èƒ½æŠŠè¿™ä¸ª Pod çœ‹ä½œå°±ç»ªäº†ã€‚ è¿™ç§ä¿¡å·çš„ä¸€ä¸ªç”¨é€”å°±æ˜¯æ§åˆ¶å“ªä¸ª Pod ä½œä¸º Service çš„åç«¯ã€‚ åœ¨ Pod è¿˜æ²¡æœ‰å‡†å¤‡å¥½çš„æ—¶å€™ï¼Œä¼šä» Service çš„è´Ÿè½½å‡è¡¡å™¨ä¸­è¢«å‰”é™¤çš„ã€‚</p><p>kubelet ä½¿ç”¨å¯åŠ¨æ¢æµ‹å™¨å¯ä»¥çŸ¥é“åº”ç”¨ç¨‹åºå®¹å™¨ä»€ä¹ˆæ—¶å€™å¯åŠ¨äº†ã€‚ å¦‚æœé…ç½®äº†è¿™ç±»æ¢æµ‹å™¨ï¼Œå°±å¯ä»¥æ§åˆ¶å®¹å™¨åœ¨å¯åŠ¨æˆåŠŸåå†è¿›è¡Œå­˜æ´»æ€§å’Œå°±ç»ªæ£€æŸ¥ï¼Œ ç¡®ä¿è¿™äº›å­˜æ´»ã€å°±ç»ªæ¢æµ‹å™¨ä¸ä¼šå½±å“åº”ç”¨ç¨‹åºçš„å¯åŠ¨ã€‚ è¿™å¯ä»¥ç”¨äºå¯¹æ…¢å¯åŠ¨å®¹å™¨è¿›è¡Œå­˜æ´»æ€§æ£€æµ‹ï¼Œé¿å…å®ƒä»¬åœ¨å¯åŠ¨è¿è¡Œä¹‹å‰å°±è¢«æ€æ‰ã€‚</p><h3 id="å®šä¹‰å­˜æ´»å‘½ä»¤" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰å­˜æ´»å‘½ä»¤" aria-hidden="true">#</a> å®šä¹‰å­˜æ´»å‘½ä»¤</h3><ul><li><p>è®¸å¤šé•¿æ—¶é—´è¿è¡Œçš„åº”ç”¨ç¨‹åºæœ€ç»ˆä¼šè¿‡æ¸¡åˆ°æ–­å¼€çš„çŠ¶æ€ï¼Œé™¤éé‡æ–°å¯åŠ¨ï¼Œå¦åˆ™æ— æ³•æ¢å¤ã€‚ Kubernetes æä¾›äº†å­˜æ´»æ¢æµ‹å™¨æ¥å‘ç°å¹¶è¡¥æ•‘è¿™ç§æƒ…å†µã€‚</p></li><li><p>åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥çœ‹åˆ° Pod ä¸­åªæœ‰ä¸€ä¸ªå®¹å™¨ã€‚</p></li><li><p><strong><code>periodSeconds</code></strong> å­—æ®µæŒ‡å®šäº† kubelet åº”è¯¥æ¯ 5 ç§’æ‰§è¡Œä¸€æ¬¡å­˜æ´»æ¢æµ‹ã€‚</p></li><li><p><strong><code>initialDelaySeconds</code></strong> å­—æ®µå‘Šè¯‰ kubelet åœ¨æ‰§è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹å‰åº”è¯¥ç­‰å¾… 5 ç§’ã€‚</p></li><li><p>kubelet åœ¨å®¹å™¨å†…æ‰§è¡Œå‘½ä»¤ <strong><code>cat /tmp/healthy</code></strong> æ¥è¿›è¡Œæ¢æµ‹ã€‚</p></li><li><p>å¦‚æœå‘½ä»¤æ‰§è¡ŒæˆåŠŸå¹¶ä¸”è¿”å›å€¼ä¸º 0ï¼Œkubelet å°±ä¼šè®¤ä¸ºè¿™ä¸ªå®¹å™¨æ˜¯å¥åº·å­˜æ´»çš„ã€‚ å¦‚æœè¿™ä¸ªå‘½ä»¤è¿”å›é 0 å€¼ï¼Œkubelet ä¼šæ€æ­»è¿™ä¸ªå®¹å™¨å¹¶é‡æ–°å¯åŠ¨å®ƒã€‚</p></li><li><p>å½“å®¹å™¨å¯åŠ¨æ—¶ï¼Œæ‰§è¡Œå¦‚ä¸‹çš„å‘½ä»¤ï¼š <strong><code>/bin/sh -c &quot;touch /tmp/healthy; sleep 30; rm -rf /tmp/healthy; sleep 600&quot;</code></strong></p></li><li><p>è¿™ä¸ªå®¹å™¨ç”Ÿå‘½çš„å‰ 30 ç§’ï¼Œ <code>/tmp/healthy</code> æ–‡ä»¶æ˜¯å­˜åœ¨çš„ã€‚ æ‰€ä»¥åœ¨è¿™æœ€å¼€å§‹çš„ 30 ç§’å†…ï¼Œæ‰§è¡Œå‘½ä»¤ <code>cat /tmp/healthy</code> ä¼šè¿”å›æˆåŠŸä»£ç ã€‚ 30 ç§’ä¹‹åï¼Œæ‰§è¡Œå‘½ä»¤ <code>cat /tmp/healthy</code> å°±ä¼šè¿”å›å¤±è´¥ä»£ç ã€‚</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">test</span><span class="token punctuation">:</span> liveness
  <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>exec
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness
    <span class="token key atrule">image</span><span class="token punctuation">:</span> k8s.gcr.io/busybox
    <span class="token key atrule">args</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /bin/sh
    <span class="token punctuation">-</span> <span class="token punctuation">-</span>c
    <span class="token punctuation">-</span> touch /tmp/healthy; sleep 30; rm <span class="token punctuation">-</span>rf /tmp/healthy; sleep 600
    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
      <span class="token key atrule">exec</span><span class="token punctuation">:</span>
        <span class="token key atrule">command</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> cat
        <span class="token punctuation">-</span> /tmp/healthy
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><blockquote><h2 id="å®šä¹‰ä¸€ä¸ªå­˜æ´»æ€httpè¯·æ±‚æ¥å£" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰ä¸€ä¸ªå­˜æ´»æ€httpè¯·æ±‚æ¥å£" aria-hidden="true">#</a> å®šä¹‰ä¸€ä¸ªå­˜æ´»æ€HTTPè¯·æ±‚æ¥å£</h2></blockquote><p>å¦å¤–ä¸€ç§ç±»å‹çš„å­˜æ´»æ¢æµ‹æ–¹å¼æ˜¯ä½¿ç”¨ HTTP GET è¯·æ±‚ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ª Pod çš„é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­è¿è¡Œä¸€ä¸ªåŸºäº <code>k8s.gcr.io/liveness</code> é•œåƒçš„å®¹å™¨ã€‚</p><h3 id="å®šä¹‰httpè¯·æ±‚æ¥å£" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰httpè¯·æ±‚æ¥å£" aria-hidden="true">#</a> å®šä¹‰HTTPè¯·æ±‚æ¥å£</h3><ul><li>åœ¨è¿™ä¸ªé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥çœ‹åˆ° Pod ä¹Ÿåªæœ‰ä¸€ä¸ªå®¹å™¨ã€‚</li><li><strong><code>periodSeconds</code></strong> å­—æ®µæŒ‡å®šäº† kubelet æ¯éš” 3 ç§’æ‰§è¡Œä¸€æ¬¡å­˜æ´»æ¢æµ‹ã€‚</li><li><strong><code>initialDelaySeconds</code></strong> å­—æ®µå‘Šè¯‰ kubelet åœ¨æ‰§è¡Œç¬¬ä¸€æ¬¡æ¢æµ‹å‰åº”è¯¥ç­‰å¾… 3 ç§’ã€‚</li><li>kubelet ä¼šå‘å®¹å™¨å†…è¿è¡Œçš„æœåŠ¡ï¼ˆæœåŠ¡ä¼šç›‘å¬ 8080 ç«¯å£ï¼‰å‘é€ä¸€ä¸ª HTTP GET è¯·æ±‚æ¥æ‰§è¡Œæ¢æµ‹ã€‚ å¦‚æœæœåŠ¡å™¨ä¸Š <strong><code>/healthz</code></strong> è·¯å¾„ä¸‹çš„å¤„ç†ç¨‹åºè¿”å›æˆåŠŸä»£ç ï¼Œåˆ™ kubelet è®¤ä¸ºå®¹å™¨æ˜¯å¥åº·å­˜æ´»çš„ã€‚ å¦‚æœå¤„ç†ç¨‹åºè¿”å›å¤±è´¥ä»£ç ï¼Œåˆ™ kubelet ä¼šæ€æ­»è¿™ä¸ªå®¹å™¨å¹¶ä¸”é‡æ–°å¯åŠ¨å®ƒã€‚</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">test</span><span class="token punctuation">:</span> liveness
  <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>http
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness
    <span class="token key atrule">image</span><span class="token punctuation">:</span> k8s.gcr.io/liveness
    <span class="token key atrule">args</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> /server
    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>				<span class="token comment">#å‘¨æœŸæ€§çš„</span>
      <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /healthz
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">8080</span>
        <span class="token key atrule">httpHeaders</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Custom<span class="token punctuation">-</span>Header
          <span class="token key atrule">value</span><span class="token punctuation">:</span> Awesome
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">3</span>
      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>kubeletåœ¨å®¹å™¨å¯åŠ¨ä¹‹å3ç§’å¼€å§‹æ‰§è¡Œå¥åº·æ£€æµ‹ã€‚æ‰€ä»¥å‰å‡ æ¬¡å¥åº·æ£€æŸ¥éƒ½æ˜¯æˆåŠŸçš„ã€‚ä½†æ˜¯10ç§’ä¹‹åï¼Œå¥åº·æ£€æŸ¥ä¼šå¤±è´¥ï¼Œå¹¶ä¸”kubeletä¼šæ€æ­»å®¹å™¨å†é‡æ–°å¯åŠ¨å®¹å™¨ã€‚</p><blockquote><h2 id="å®šä¹‰tcpçš„å­˜æ´»æ¢æµ‹" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰tcpçš„å­˜æ´»æ¢æµ‹" aria-hidden="true">#</a> å®šä¹‰TCPçš„å­˜æ´»æ¢æµ‹</h2></blockquote><p>ç¬¬ä¸‰ç§ç±»å‹çš„å­˜æ´»æ¢æµ‹æ˜¯ä½¿ç”¨ TCP å¥—æ¥å­—ã€‚ é€šè¿‡é…ç½®ï¼Œkubelet ä¼šå°è¯•åœ¨æŒ‡å®šç«¯å£å’Œå®¹å™¨å»ºç«‹å¥—æ¥å­—é“¾æ¥ã€‚ å¦‚æœèƒ½å»ºç«‹è¿æ¥ï¼Œè¿™ä¸ªå®¹å™¨å°±è¢«çœ‹ä½œæ˜¯å¥åº·çš„ï¼Œå¦‚æœä¸èƒ½åˆ™è¿™ä¸ªå®¹å™¨å°±è¢«çœ‹ä½œæ˜¯æœ‰é—®é¢˜çš„ã€‚</p><h3 id="å®šä¹‰tcpæ¢é’ˆ" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰tcpæ¢é’ˆ" aria-hidden="true">#</a> å®šä¹‰TCPæ¢é’ˆ</h3><ul><li>å¦‚ä¸‹å®ä¾‹ï¼Œkubelet ä¼šåœ¨**<code>å®¹å™¨å¯åŠ¨ 5 ç§’åå‘é€ç¬¬ä¸€ä¸ªå°±ç»ªæ¢æµ‹</code>ã€‚**</li><li>è¿™ä¼šå°è¯•è¿æ¥ <strong><code>nginx</code></strong> å®¹å™¨çš„80ç«¯å£ã€‚ å¦‚æœæ¢æµ‹æˆåŠŸï¼Œè¿™ä¸ª Pod ä¼šè¢«æ ‡è®°ä¸ºå°±ç»ªçŠ¶æ€ï¼Œkubelet å°†ç»§ç»­æ¯éš” 10 ç§’è¿è¡Œä¸€æ¬¡æ£€æµ‹ã€‚</li><li>é™¤äº†å°±ç»ªæ¢æµ‹ï¼Œ<strong><code>è¿™ä¸ªé…ç½®åŒ…æ‹¬äº†ä¸€ä¸ªå­˜æ´»æ¢æµ‹ã€‚</code></strong></li><li>kubelet ä¼šåœ¨**<code>å®¹å™¨å¯åŠ¨ 15 ç§’åè¿›è¡Œç¬¬ä¸€æ¬¡å­˜æ´»æ¢æµ‹ã€‚</code>** ä¸å°±ç»ªæ¢æµ‹ç±»ä¼¼ï¼Œä¼šå°è¯•è¿æ¥**<code>nginx</code>**å®¹å™¨çš„80ç«¯å£ã€‚ å¦‚æœå­˜æ´»æ¢æµ‹å¤±è´¥ï¼Œè¿™ä¸ªå®¹å™¨ä¼šè¢«é‡æ–°å¯åŠ¨ã€‚</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat tcp.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span> 			<span class="token comment">#å®šæœŸæ€§çš„</span>
      <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span> 
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span> 
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">10</span>
    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span> 
      <span class="token key atrule">tcpSocket</span><span class="token punctuation">:</span>
        <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span> 
      <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">15</span>
      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">20</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><strong>æŸ¥çœ‹çŠ¶æ€çš„è½¬å˜</strong></li></ul><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME            READY   STATUS             RESTARTS   AGE
nginx           <span class="token number">0</span>/1     Running            <span class="token number">0</span>          27s

<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME            READY   STATUS             RESTARTS   AGE
nginx           <span class="token number">1</span>/1     Running            <span class="token number">0</span>          65s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h2 id="å®šä¹‰å°±ç»ªæ¢æµ‹å™¨" tabindex="-1"><a class="header-anchor" href="#å®šä¹‰å°±ç»ªæ¢æµ‹å™¨" aria-hidden="true">#</a> å®šä¹‰å°±ç»ªæ¢æµ‹å™¨</h2></blockquote><p>æœ‰æ—¶å€™ï¼Œåº”ç”¨ç¨‹åºä¼šæš‚æ—¶æ€§çš„ä¸èƒ½æä¾›é€šä¿¡æœåŠ¡ã€‚ ä¾‹å¦‚ï¼Œåº”ç”¨ç¨‹åºåœ¨å¯åŠ¨æ—¶å¯èƒ½éœ€è¦åŠ è½½å¾ˆå¤§çš„æ•°æ®æˆ–é…ç½®æ–‡ä»¶ï¼Œæˆ–æ˜¯å¯åŠ¨åè¦ä¾èµ–ç­‰å¾…å¤–éƒ¨æœåŠ¡ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ—¢ä¸æƒ³æ€æ­»åº”ç”¨ç¨‹åºï¼Œä¹Ÿä¸æƒ³ç»™å®ƒå‘é€è¯·æ±‚ã€‚ Kubernetes æä¾›äº†å°±ç»ªæ¢æµ‹å™¨æ¥å‘ç°å¹¶ç¼“è§£è¿™äº›æƒ…å†µã€‚ å®¹å™¨æ‰€åœ¨ Pod ä¸ŠæŠ¥è¿˜æœªå°±ç»ªçš„ä¿¡æ¯ï¼Œå¹¶ä¸”ä¸æ¥å—é€šè¿‡ Kubernetes Service çš„æµé‡ã€‚å°±ç»ªæ¢æµ‹å™¨åœ¨å®¹å™¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­ä¿æŒè¿è¡ŒçŠ¶æ€ã€‚</p><p><strong>æ³¨æ„ï¼š</strong> æ´»è·ƒæ€§æ¢æµ‹å™¨ <em>ä¸ç­‰å¾…</em> å°±ç»ªæ€§æ¢æµ‹å™¨æˆåŠŸã€‚ å¦‚æœè¦åœ¨æ‰§è¡Œæ´»è·ƒæ€§æ¢æµ‹å™¨ä¹‹å‰ç­‰å¾…ï¼Œåº”è¯¥ä½¿ç”¨ initialDelaySeconds æˆ– startupProbeã€‚</p><p>å°±ç»ªæ¢æµ‹å™¨çš„é…ç½®å’Œå­˜æ´»æ¢æµ‹å™¨çš„é…ç½®ç›¸ä¼¼ã€‚ å”¯ä¸€åŒºåˆ«å°±æ˜¯è¦ä½¿ç”¨ <code>readinessProbe</code> å­—æ®µï¼Œè€Œä¸æ˜¯ <code>livenessProbe</code> å­—æ®µã€‚</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">readinessProbe</span><span class="token punctuation">:</span>
  <span class="token key atrule">exec</span><span class="token punctuation">:</span>
    <span class="token key atrule">command</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> cat
    <span class="token punctuation">-</span> /tmp/healthy
  <span class="token key atrule">initialDelaySeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
  <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">5</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><h2 id="é…ç½®æ¢æµ‹å™¨" tabindex="-1"><a class="header-anchor" href="#é…ç½®æ¢æµ‹å™¨" aria-hidden="true">#</a> é…ç½®æ¢æµ‹å™¨</h2></blockquote><ul><li><h4 id="probe-æœ‰å¾ˆå¤šé…ç½®å­—æ®µ-å¯ä»¥ä½¿ç”¨è¿™äº›å­—æ®µç²¾ç¡®çš„æ§åˆ¶å­˜æ´»å’Œå°±ç»ªæ£€æµ‹çš„è¡Œä¸º" tabindex="-1"><a class="header-anchor" href="#probe-æœ‰å¾ˆå¤šé…ç½®å­—æ®µ-å¯ä»¥ä½¿ç”¨è¿™äº›å­—æ®µç²¾ç¡®çš„æ§åˆ¶å­˜æ´»å’Œå°±ç»ªæ£€æµ‹çš„è¡Œä¸º" aria-hidden="true">#</a> <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#probe-v1-core" target="_blank" rel="noopener noreferrer">Probe<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æœ‰å¾ˆå¤šé…ç½®å­—æ®µï¼Œå¯ä»¥ä½¿ç”¨è¿™äº›å­—æ®µç²¾ç¡®çš„æ§åˆ¶å­˜æ´»å’Œå°±ç»ªæ£€æµ‹çš„è¡Œä¸ºï¼š</h4><ul><li><p><strong><code>initialDelaySeconds</code></strong>ï¼šå®¹å™¨å¯åŠ¨åè¦ç­‰å¾…å¤šå°‘ç§’åå­˜æ´»å’Œå°±ç»ªæ¢æµ‹å™¨æ‰è¢«åˆå§‹åŒ–ï¼Œé»˜è®¤æ˜¯ 0 ç§’ï¼Œæœ€å°å€¼æ˜¯ 0ã€‚</p></li><li><p><strong><code>periodSeconds</code></strong>ï¼šæ‰§è¡Œæ¢æµ‹çš„æ—¶é—´é—´éš”ï¼ˆå•ä½æ˜¯ç§’ï¼‰ã€‚é»˜è®¤æ˜¯ 10 ç§’ã€‚æœ€å°å€¼æ˜¯ 1ã€‚</p></li><li><p><strong><code>timeoutSeconds</code></strong>ï¼šæ¢æµ‹çš„è¶…æ—¶åç­‰å¾…å¤šå°‘ç§’ã€‚é»˜è®¤å€¼æ˜¯ 1 ç§’ã€‚æœ€å°å€¼æ˜¯ 1ã€‚</p></li><li><p><strong><code>successThreshold</code></strong>ï¼šæ¢æµ‹å™¨åœ¨å¤±è´¥åï¼Œè¢«è§†ä¸ºæˆåŠŸçš„æœ€å°è¿ç»­æˆåŠŸæ•°ã€‚é»˜è®¤å€¼æ˜¯ 1ã€‚ å­˜æ´»å’Œå¯åŠ¨æ¢æµ‹çš„è¿™ä¸ªå€¼å¿…é¡»æ˜¯ 1ã€‚æœ€å°å€¼æ˜¯ 1ã€‚</p></li><li><p><strong><code>failureThreshold</code></strong>ï¼šå½“æ¢æµ‹å¤±è´¥æ—¶ï¼ŒKubernetes çš„é‡è¯•æ¬¡æ•°ã€‚ å­˜æ´»æ¢æµ‹æƒ…å†µä¸‹çš„æ”¾å¼ƒå°±æ„å‘³ç€é‡æ–°å¯åŠ¨å®¹å™¨ã€‚ å°±ç»ªæ¢æµ‹æƒ…å†µä¸‹çš„æ”¾å¼ƒ Pod ä¼šè¢«æ‰“ä¸Šæœªå°±ç»ªçš„æ ‡ç­¾ã€‚é»˜è®¤å€¼æ˜¯ 3ã€‚æœ€å°å€¼æ˜¯ 1ã€‚</p></li></ul></li></ul><h3 id="http-æ¢æµ‹" tabindex="-1"><a class="header-anchor" href="#http-æ¢æµ‹" aria-hidden="true">#</a> HTTP æ¢æµ‹</h3><ul><li><h4 id="http-probes-å¯ä»¥åœ¨-httpget-ä¸Šé…ç½®é¢å¤–çš„å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#http-probes-å¯ä»¥åœ¨-httpget-ä¸Šé…ç½®é¢å¤–çš„å­—æ®µ" aria-hidden="true">#</a> <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#httpgetaction-v1-core" target="_blank" rel="noopener noreferrer">HTTP Probes<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> å¯ä»¥åœ¨ <code>httpGet</code> ä¸Šé…ç½®é¢å¤–çš„å­—æ®µï¼š</h4><ul><li><p><strong><code>host</code>ï¼šè¿æ¥ä½¿ç”¨çš„ä¸»æœºåï¼Œé»˜è®¤æ˜¯ Pod çš„ IPã€‚ä¹Ÿå¯ä»¥åœ¨ HTTP å¤´ä¸­è®¾ç½® â€œHostâ€ æ¥ä»£æ›¿ã€‚</strong></p></li><li><p><strong><code>scheme</code> ï¼šç”¨äºè®¾ç½®è¿æ¥ä¸»æœºçš„æ–¹å¼ï¼ˆHTTP è¿˜æ˜¯ HTTPSï¼‰ã€‚é»˜è®¤æ˜¯ HTTPã€‚</strong></p></li><li><p><strong><code>path</code>ï¼šè®¿é—® HTTP æœåŠ¡çš„è·¯å¾„ã€‚é»˜è®¤å€¼ä¸º &quot;/&quot;ã€‚</strong></p></li><li><p><strong><code>httpHeaders</code>ï¼šè¯·æ±‚ä¸­è‡ªå®šä¹‰çš„ HTTP å¤´ã€‚HTTP å¤´å­—æ®µå…è®¸é‡å¤ã€‚</strong></p></li><li><p><strong><code>port</code>ï¼šè®¿é—®å®¹å™¨çš„ç«¯å£å·æˆ–è€…ç«¯å£åã€‚å¦‚æœæ•°å­—å¿…é¡»åœ¨ 1 ï½ 65535 ä¹‹é—´ã€‚</strong></p></li></ul></li></ul><p>ä½ å¯ä»¥é€šè¿‡ä¸ºæ¢æµ‹è®¾ç½® <code>.httpHeaders</code> æ¥é‡è½½é»˜è®¤çš„å¤´éƒ¨å­—æ®µå€¼ï¼›ä¾‹å¦‚ï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
  <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
    <span class="token key atrule">httpHeaders</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Accept
        <span class="token key atrule">value</span><span class="token punctuation">:</span> application/json

<span class="token key atrule">startupProbe</span><span class="token punctuation">:</span>
  <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
    <span class="token key atrule">httpHeaders</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> User<span class="token punctuation">-</span>Agent
        <span class="token key atrule">value</span><span class="token punctuation">:</span> MyUserAgent
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½ ä¹Ÿå¯ä»¥é€šè¿‡å°†è¿™äº›å¤´éƒ¨å­—æ®µå®šä¹‰ä¸ºç©ºå€¼ï¼Œä»è¯·æ±‚ä¸­å»æ‰è¿™äº›å¤´éƒ¨å­—æ®µã€‚</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
  <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
    <span class="token key atrule">httpHeaders</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> Accept
        <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>

<span class="token key atrule">startupProbe</span><span class="token punctuation">:</span>
  <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
    <span class="token key atrule">httpHeaders</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> User<span class="token punctuation">-</span>Agent
        <span class="token key atrule">value</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="tcp-æ¢æµ‹" tabindex="-1"><a class="header-anchor" href="#tcp-æ¢æµ‹" aria-hidden="true">#</a> TCP æ¢æµ‹</h3><p>å¯¹äºä¸€æ¬¡ TCP æ¢æµ‹ï¼Œkubelet åœ¨èŠ‚ç‚¹ä¸Šï¼ˆä¸æ˜¯åœ¨ Pod é‡Œé¢ï¼‰å»ºç«‹æ¢æµ‹è¿æ¥ï¼Œ è¿™æ„å‘³ç€ä½ ä¸èƒ½åœ¨ <code>host</code> å‚æ•°ä¸Šé…ç½®æœåŠ¡åç§°ï¼Œå› ä¸º kubelet ä¸èƒ½è§£ææœåŠ¡åç§°ã€‚</p><ul><li><h4 id="æ¢æµ‹å™¨çº§åˆ«-terminationgraceperiodseconds" tabindex="-1"><a class="header-anchor" href="#æ¢æµ‹å™¨çº§åˆ«-terminationgraceperiodseconds" aria-hidden="true">#</a> æ¢æµ‹å™¨çº§åˆ« <code>terminationGracePeriodSeconds</code></h4><ul><li><strong>FEATURE STATE:</strong> <code>Kubernetes v1.22 [beta]</code></li><li>åœ¨ 1.21 åŠæ›´é«˜ç‰ˆæœ¬ä¸­ï¼Œå½“ç‰¹æ€§é—¨æ§ <code>ProbeTerminationGracePeriod</code> ä¸º å¯ç”¨çŠ¶æ€æ—¶ï¼Œç”¨æˆ·å¯ä»¥æŒ‡å®šä¸€ä¸ªæ¢æµ‹çº§åˆ«çš„ <code>terminationGracePeriodSeconds</code> ä½œä¸º æ¢é’ˆè§„æ ¼çš„ä¸€éƒ¨åˆ†ã€‚</li><li>å½“ç‰¹æ€§é—¨æ§è¢«å¯ç”¨æ—¶ï¼Œå¹¶ä¸” Pod çº§å’Œæ¢é’ˆçº§çš„ <code>terminationGracePeriodSeconds</code> éƒ½å·²è®¾ç½®ï¼Œkubelet å°† ä½¿ç”¨æ¢é’ˆçº§è®¾ç½®çš„å€¼ã€‚</li></ul></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># cat http_probe.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> 172.25.253.3/library/nginx
    <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">ports</span><span class="token punctuation">:</span> 
    <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span> 
      <span class="token key atrule">name</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>port 
      <span class="token key atrule">hostPort</span><span class="token punctuation">:</span> <span class="token number">80</span> 
    <span class="token key atrule">livenessProbe</span><span class="token punctuation">:</span>
      <span class="token key atrule">httpGet</span><span class="token punctuation">:</span>
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /healthz 
        <span class="token key atrule">port</span><span class="token punctuation">:</span> liveness<span class="token punctuation">-</span>port 
      <span class="token key atrule">failureThreshold</span><span class="token punctuation">:</span> <span class="token number">1</span> 		<span class="token comment">#åœ¨æµ‹è¯•åè¢«è§†ä¸ºå¤±è´¥çš„æ¢é’ˆçš„æœ€å°è¿ç»­æ•…éšœæ•°æˆåŠŸçš„</span>
      <span class="token key atrule">periodSeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>
      <span class="token key atrule">terminationGracePeriodSeconds</span><span class="token punctuation">:</span> <span class="token number">60</span>   <span class="token comment">#å¯é€‰çš„æŒç»­æ—¶é—´ï¼ˆç§’ï¼‰ï¼Œpodéœ€è¦åœ¨æ¢å¤´æ•…éšœå®½é™æœŸæ˜¯åœ¨ç§’ä¹‹åçš„æŒç»­æ—¶é—´ã€‚</span>
      
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME                                      READY   STATUS    RESTARTS   AGE
nfs<span class="token punctuation">-</span>client<span class="token punctuation">-</span>provisioner<span class="token punctuation">-</span>654754dd8d<span class="token punctuation">-</span>hnm2g   1/1     Running   0          66m
nginx                                     1/1     Running   0          3s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦‚æœä½ å·²ç»ä¸ºç°æœ‰ Pod è®¾ç½®äº† â€œterminationGracePeriodSecondsâ€ å­—æ®µå¹¶ä¸” ä¸å†å¸Œæœ›ä½¿ç”¨é’ˆå¯¹æ¯ä¸ªæ¢é’ˆçš„ç»ˆæ­¢å®½é™æœŸï¼Œåˆ™å¿…é¡»åˆ é™¤é‚£äº›ç°æœ‰çš„ Podã€‚</li><li>ï¼ˆæ§åˆ¶å¹³é¢æˆ–æŸäº›å…¶ä»–ç»„ä»¶ï¼‰åˆ›å»ºæ›¿æ¢Podsï¼Œå¹¶ä¸”ç‰¹æ€§é—¨æ§â€œProbeTerminationGracePeriodâ€è¢«ç¦ç”¨ï¼Œé‚£ä¹ˆAPIæœåŠ¡å™¨ä¼šå¿½ç•¥Podçº§åˆ«çš„<code>terminationGracePeriodSeconds</code>å­—æ®µï¼Œå³ä½¿Podæ¨¡æ¿æŒ‡å®šäº†å®ƒã€‚</li></ul><p>æ¢æµ‹å™¨çº§åˆ«çš„ <code>terminationGracePeriodSeconds</code> ä¸èƒ½ç”¨äºè®¾ç½®å°±ç»ªæ€æ¢é’ˆã€‚ å®ƒå°†è¢« API æœåŠ¡å™¨æ‹’ç»ã€‚</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods </span>
NAME                                      READY   STATUS             RESTARTS     AGE
nfs-client-provisioner-654754dd8d-hnm2g   <span class="token number">1</span>/1     Running            <span class="token number">0</span>            72m
nginx                                     <span class="token number">0</span>/1     CrashLoopBackOff   <span class="token number">5</span> <span class="token punctuation">(</span>0s ago<span class="token punctuation">)</span>   6m1s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ä½¿ç”¨rbacé‰´æƒ" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨rbacé‰´æƒ" aria-hidden="true">#</a> ä½¿ç”¨RBACé‰´æƒ</h2><p>åŸºäºè§’è‰²ï¼ˆRoleï¼‰çš„è®¿é—®æ§åˆ¶ï¼ˆRBACï¼‰æ˜¯ä¸€ç§åŸºäºç»„ç»‡ä¸­ç”¨æˆ·çš„è§’è‰²æ¥è°ƒèŠ‚æ§åˆ¶å¯¹ è®¡ç®—æœºæˆ–ç½‘ç»œèµ„æºçš„è®¿é—®çš„æ–¹æ³•ã€‚</p><p>RBAC é‰´æƒæœºåˆ¶ä½¿ç”¨ <code>rbac.authorization.k8s.io</code> <a href="https://kubernetes.io/zh/docs/concepts/overview/kubernetes-api/#api-groups-and-versioning" target="_blank" rel="noopener noreferrer">API ç»„<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æ¥é©±åŠ¨é‰´æƒå†³å®šï¼Œå…è®¸ä½ é€šè¿‡ Kubernetes API åŠ¨æ€é…ç½®ç­–ç•¥ã€‚</p><p>è¦å¯ç”¨ RBACï¼Œåœ¨å¯åŠ¨ <a href="https://kubernetes.io/zh/docs/reference/command-line-tools-reference/kube-apiserver/" target="_blank" rel="noopener noreferrer">API æœåŠ¡å™¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æ—¶å°† <code>--authorization-mode</code> å‚æ•°è®¾ç½®ä¸ºä¸€ä¸ªé€—å·åˆ†éš”çš„åˆ—è¡¨å¹¶ç¡®ä¿å…¶ä¸­åŒ…å« <code>RBAC</code>ã€‚</p><h3 id="api-å¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#api-å¯¹è±¡" aria-hidden="true">#</a> API å¯¹è±¡</h3><p>RBAC API å£°æ˜äº†å››ç§ Kubernetes å¯¹è±¡ï¼š<em>Role</em>ã€<em>ClusterRole</em>ã€<em>RoleBinding</em> å’Œ <em>ClusterRoleBinding</em>ã€‚ä½ å¯ä»¥åƒä½¿ç”¨å…¶ä»– Kubernetes å¯¹è±¡ä¸€æ ·ï¼Œ é€šè¿‡ç±»ä¼¼ <code>kubectl</code> è¿™ç±»å·¥å…· <a href="https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/kubernetes-objects/#understanding-kubernetes-objects" target="_blank" rel="noopener noreferrer">æè¿°å¯¹è±¡<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>, æˆ–ä¿®è¡¥å¯¹è±¡ã€‚</p><h3 id="roleå’Œclusterrole" tabindex="-1"><a class="header-anchor" href="#roleå’Œclusterrole" aria-hidden="true">#</a> Roleå’ŒClusterRole</h3><p>RBAC çš„ <em>Role</em> æˆ– <em>ClusterRole</em> ä¸­<code>åŒ…å«ä¸€ç»„ä»£è¡¨ç›¸å…³æƒé™çš„è§„åˆ™</code>ã€‚ <code>è¿™äº›æƒé™æ˜¯çº¯ç²¹ç´¯åŠ çš„ï¼ˆä¸å­˜åœ¨æ‹’ç»æŸæ“ä½œçš„è§„åˆ™ï¼‰</code>ã€‚</p><p>Role æ€»æ˜¯ç”¨æ¥åœ¨æŸä¸ª<a href="https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/namespaces/" target="_blank" rel="noopener noreferrer">åå­—ç©ºé—´<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> å†…è®¾ç½®è®¿é—®æƒé™ï¼›åœ¨ä½ åˆ›å»º Role æ—¶ï¼Œä½ å¿…é¡»æŒ‡å®šè¯¥ Role æ‰€å±çš„åå­—ç©ºé—´ã€‚</p><p>ä¸ä¹‹ç›¸å¯¹ï¼ŒClusterRole åˆ™æ˜¯ä¸€ä¸ªé›†ç¾¤ä½œç”¨åŸŸçš„èµ„æºã€‚è¿™ä¸¤ç§èµ„æºçš„åå­—ä¸åŒï¼ˆRole å’Œ ClusterRoleï¼‰æ˜¯å› ä¸º Kubernetes å¯¹è±¡è¦ä¹ˆæ˜¯åå­—ç©ºé—´ä½œç”¨åŸŸçš„ï¼Œè¦ä¹ˆæ˜¯é›†ç¾¤ä½œç”¨åŸŸçš„ï¼Œ ä¸å¯ä¸¤è€…å…¼å…·ã€‚</p><p><strong>ClusterRole æœ‰è‹¥å¹²ç”¨æ³•ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥ï¼š</strong></p><ol><li>å®šä¹‰å¯¹æŸåå­—ç©ºé—´åŸŸå¯¹è±¡çš„è®¿é—®æƒé™ï¼Œå¹¶å°†åœ¨å„ä¸ªåå­—ç©ºé—´å†…å®Œæˆæˆæƒï¼›</li><li>ä¸ºåå­—ç©ºé—´ä½œç”¨åŸŸçš„å¯¹è±¡è®¾ç½®è®¿é—®æƒé™ï¼Œå¹¶è·¨æ‰€æœ‰åå­—ç©ºé—´æ‰§è¡Œæˆæƒï¼›</li><li>ä¸ºé›†ç¾¤ä½œç”¨åŸŸçš„èµ„æºå®šä¹‰è®¿é—®æƒé™ã€‚</li></ol><h3 id="roleçš„ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#roleçš„ç¤ºä¾‹" aria-hidden="true">#</a> Roleçš„ç¤ºä¾‹</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½äº &quot;default&quot; åå­—ç©ºé—´çš„ Role çš„ç¤ºä¾‹ï¼Œå¯ç”¨æ¥æˆäºˆå¯¹ <a href="https://kubernetes.io/docs/concepts/workloads/pods/pod-overview/" target="_blank" rel="noopener noreferrer">pods<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> çš„è¯»è®¿é—®æƒé™ï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master role<span class="token punctuation">]</span><span class="token comment"># kubectl create role pod-reader --namespace=default --resource=pods  --verb=get,watch,list --dry-run  -o yaml &gt; role.yaml </span>

<span class="token punctuation">[</span>root@master role<span class="token punctuation">]</span><span class="token comment"># cat role.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role						<span class="token comment">#æŒ‡å®šèµ„æºç±»å‹ä¸ºRole</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>reader			
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default			<span class="token comment">#åå­—ç©ºé—´ä¸ºé»˜è®¤</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>					<span class="token comment">#å¯ä»¥è®¿é—®çš„èµ„æºæ˜¯POD</span>
  <span class="token punctuation">-</span> pods
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>						<span class="token comment">#å¯¹è¯¥èµ„æºå¯ä»¥æ“ä½œçš„æƒé™ è¯»è®¿é—®æƒé™</span>
  <span class="token punctuation">-</span> get			
  <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> list
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="clusterroleç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#clusterroleç¤ºä¾‹" aria-hidden="true">#</a> ClusterRoleç¤ºä¾‹</h3><p><strong>ClusterRole å¯ä»¥å’Œ Role ç›¸åŒå®Œæˆæˆæƒã€‚ å› ä¸º ClusterRole å±äºé›†ç¾¤èŒƒå›´ï¼Œæ‰€ä»¥å®ƒä¹Ÿå¯ä»¥ä¸ºä»¥ä¸‹èµ„æºæˆäºˆè®¿é—®æƒé™ï¼š</strong></p><ul><li>é›†ç¾¤èŒƒå›´èµ„æºï¼ˆæ¯”å¦‚ <a href="https://kubernetes.io/zh/docs/concepts/architecture/nodes/" target="_blank" rel="noopener noreferrer">èŠ‚ç‚¹ï¼ˆNodeï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ï¼‰</li><li>éèµ„æºç«¯ç‚¹ï¼ˆæ¯”å¦‚ <code>/healthz</code>ï¼‰</li><li>è·¨åå­—ç©ºé—´è®¿é—®çš„åå­—ç©ºé—´ä½œç”¨åŸŸçš„èµ„æºï¼ˆå¦‚ Podsï¼‰ï¼Œæ¯”å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ ClusterRole æ¥å…è®¸æŸç‰¹å®šç”¨æˆ·æ‰§è¡Œ <code>kubectl get pods --all-namespaces</code></li></ul><p>ä¸‹é¢æ˜¯ä¸€ä¸ª ClusterRole çš„ç¤ºä¾‹ï¼Œå¯ç”¨æ¥ä¸ºä»»ä¸€ç‰¹å®šåå­—ç©ºé—´ä¸­çš„ <a href="https://kubernetes.io/zh/docs/concepts/configuration/secret/" target="_blank" rel="noopener noreferrer">Secret<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æˆäºˆè¯»è®¿é—®æƒé™ï¼Œ æˆ–è€…è·¨åå­—ç©ºé—´çš„è®¿é—®æƒé™ï¼ˆå–å†³äºè¯¥è§’è‰²æ˜¯å¦‚ä½•<a href="https://kubernetes.io/zh/docs/reference/access-authn-authz/rbac/#rolebinding-and-clusterrolebinding" target="_blank" rel="noopener noreferrer">ç»‘å®š<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>çš„ï¼‰ï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master role<span class="token punctuation">]</span><span class="token comment"># kubectl create clusterrole secret-reader --resource=secrets --verb=get,watch,list --dry-run -o yaml &gt; clusterrole.yaml </span>

<span class="token punctuation">[</span>root@master role<span class="token punctuation">]</span><span class="token comment"># cat clusterrole.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret<span class="token punctuation">-</span>reader
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&quot;&quot;</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> secrets
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> get
  <span class="token punctuation">-</span> watch
  <span class="token punctuation">-</span> list
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="rolebindingå’Œclusterrolebinding" tabindex="-1"><a class="header-anchor" href="#rolebindingå’Œclusterrolebinding" aria-hidden="true">#</a> RoleBindingå’ŒClusterRoleBinding</h3><p>è§’è‰²ç»‘å®šï¼ˆRole Bindingï¼‰æ˜¯<code>å°†è§’è‰²ä¸­å®šä¹‰çš„æƒé™èµ‹äºˆä¸€ä¸ªæˆ–è€…ä¸€ç»„ç”¨æˆ·</code>ã€‚ å®ƒåŒ…å«è‹¥å¹² <strong>ä¸»ä½“</strong>ï¼ˆç”¨æˆ·ã€ç»„æˆ–æœåŠ¡è´¦æˆ·ï¼‰çš„åˆ—è¡¨å’Œå¯¹è¿™äº›ä¸»ä½“æ‰€è·å¾—çš„è§’è‰²çš„å¼•ç”¨ã€‚ RoleBinding åœ¨æŒ‡å®šçš„åå­—ç©ºé—´ä¸­æ‰§è¡Œæˆæƒï¼Œè€Œ ClusterRoleBinding åœ¨é›†ç¾¤èŒƒå›´æ‰§è¡Œæˆæƒã€‚</p><p>ä¸€ä¸ª RoleBinding å¯ä»¥å¼•ç”¨åŒä¸€çš„åå­—ç©ºé—´ä¸­çš„ä»»ä½• Roleã€‚ æˆ–è€…ï¼Œä¸€ä¸ª RoleBinding å¯ä»¥å¼•ç”¨æŸ ClusterRole å¹¶å°†è¯¥ ClusterRole ç»‘å®šåˆ° RoleBinding æ‰€åœ¨çš„åå­—ç©ºé—´ã€‚ å¦‚æœä½ å¸Œæœ›å°†æŸ ClusterRole ç»‘å®šåˆ°é›†ç¾¤ä¸­æ‰€æœ‰åå­—ç©ºé—´ï¼Œä½ è¦ä½¿ç”¨ ClusterRoleBindingã€‚</p><h3 id="rolebinding-ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#rolebinding-ç¤ºä¾‹" aria-hidden="true">#</a> RoleBinding ç¤ºä¾‹</h3><ul><li>ä¸‹é¢çš„ä¾‹å­ä¸­çš„ RoleBinding å°† &quot;pod-reader&quot; Role æˆäºˆåœ¨ &quot;default&quot; åå­—ç©ºé—´ä¸­çš„ç”¨æˆ· &quot;jane&quot;ã€‚ è¿™æ ·ï¼Œç”¨æˆ· &quot;jane&quot; å°±å…·æœ‰äº†è¯»å– &quot;default&quot; åå­—ç©ºé—´ä¸­ pods çš„æƒé™ã€‚</li><li><code>RoleBinding ä¹Ÿå¯ä»¥å¼•ç”¨ ClusterRoleï¼Œä»¥å°†å¯¹åº” ClusterRole ä¸­å®šä¹‰çš„è®¿é—®æƒé™æˆäºˆ RoleBinding æ‰€åœ¨åå­—ç©ºé—´çš„èµ„æºã€‚</code></li><li><code>è¿™ç§å¼•ç”¨ä½¿å¾—ä½ å¯ä»¥è·¨æ•´ä¸ªé›†ç¾¤å®šä¹‰ä¸€ç»„é€šç”¨çš„è§’è‰²ï¼Œ ä¹‹ååœ¨å¤šä¸ªåå­—ç©ºé—´ä¸­å¤ç”¨ã€‚</code></li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master role<span class="token punctuation">]</span><span class="token comment"># kubectl create rolebinding read-pods --namespace=default --user=jane --role=pod-reader --dry-run -o yaml &gt; rolebinding.yaml </span>

<span class="token punctuation">[</span>root@master role<span class="token punctuation">]</span><span class="token comment"># cat rolebinding.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding						<span class="token comment">#æ­¤è§’è‰²ç»‘å®šå…è®¸â€˜janeâ€™è¯»å–â€˜defaultâ€™åå­—ç©ºé—´ä¸­çš„Pods</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> read<span class="token punctuation">-</span>pods
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>								<span class="token comment">#æŒ‡å®šæŸä¸ªRoleæˆ–è€…æ˜¯Clusterroleçš„ç»‘å®šå…³ç³»</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Role							<span class="token comment">#æ­¤å­—æ®µæ˜¯Roleæˆ–è€…clusterRole</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>reader						<span class="token comment">#è¿™æ˜¯ä½ çš„Roleæˆ–è€…clusterRoleçš„åå­—åŒ¹é…					</span>
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>								<span class="token comment">#ä½ å¯ä»¥æŒ‡å®šä¸æ­¢ä¸€ä¸ªsubjectï¼ˆä¸»ä½“ï¼‰</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> User
  <span class="token key atrule">name</span><span class="token punctuation">:</span> jane							<span class="token comment">#nameæ˜¯åŒºåˆ†å¤§å°å†™çš„</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°½ç®¡ä¸‹é¢çš„ RoleBinding å¼•ç”¨çš„æ˜¯ä¸€ä¸ª ClusterRoleï¼Œ&quot;dave&quot;ï¼ˆè¿™é‡Œçš„ä¸»ä½“ï¼Œ åŒºåˆ†å¤§å°å†™ï¼‰åªèƒ½è®¿é—® &quot;development&quot; åå­—ç©ºé—´ä¸­çš„ Secrets å¯¹è±¡ï¼Œå› ä¸º RoleBinding æ‰€åœ¨çš„åå­—ç©ºé—´ï¼ˆç”±å…¶ metadata å†³å®šï¼‰æ˜¯ &quot;development&quot;ã€‚</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token comment"># æ­¤è§’è‰²ç»‘å®šä½¿å¾—ç”¨æˆ· &quot;dave&quot; èƒ½å¤Ÿè¯»å– &quot;development&quot; åå­—ç©ºé—´ä¸­çš„ Secrets</span>
<span class="token comment"># ä½ éœ€è¦ä¸€ä¸ªåä¸º &quot;secret-reader&quot; çš„ ClusterRole</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> RoleBinding
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> read<span class="token punctuation">-</span>secrets
  <span class="token comment"># RoleBinding çš„åå­—ç©ºé—´å†³å®šäº†è®¿é—®æƒé™çš„æˆäºˆèŒƒå›´ã€‚</span>
  <span class="token comment"># è¿™é‡Œéšå«æˆæƒä»…åœ¨ &quot;development&quot; åå­—ç©ºé—´å†…çš„è®¿é—®æƒé™ã€‚</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> development
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">kind</span><span class="token punctuation">:</span> User
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dave <span class="token comment"># &#39;name&#39; æ˜¯åŒºåˆ†å¤§å°å†™çš„</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret<span class="token punctuation">-</span>reader
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="clusterrolebindingç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#clusterrolebindingç¤ºä¾‹" aria-hidden="true">#</a> ClusterRoleBindingç¤ºä¾‹</h3><p>è¦è·¨æ•´ä¸ªé›†ç¾¤å®Œæˆè®¿é—®æƒé™çš„æˆäºˆï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª ClusterRoleBindingã€‚ ä¸‹é¢çš„ ClusterRoleBinding å…è®¸ &quot;manager&quot; ç»„å†…çš„æ‰€æœ‰ç”¨æˆ·è®¿é—®ä»»ä½•åå­—ç©ºé—´ä¸­çš„ Secretsã€‚</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master role<span class="token punctuation">]</span><span class="token comment"># kubectl create clusterrolebinding read-secrets-global --clusterrole=secret-reader --group=manager  --dry-run -o yaml &gt; clusterrolebinding.yaml </span>

<span class="token punctuation">[</span>root@master role<span class="token punctuation">]</span><span class="token comment"># cat clusterrolebinding.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRoleBinding			<span class="token comment"># æ­¤é›†ç¾¤è§’è‰²ç»‘å®šå…è®¸ â€œmanagerâ€ ç»„ä¸­çš„ä»»ä½•äººè®¿é—®ä»»ä½•åå­—ç©ºé—´ä¸­çš„ secrets</span>
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> read<span class="token punctuation">-</span>secrets<span class="token punctuation">-</span>global
<span class="token key atrule">roleRef</span><span class="token punctuation">:</span>
  <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
  <span class="token key atrule">name</span><span class="token punctuation">:</span> secret<span class="token punctuation">-</span>reader
<span class="token key atrule">subjects</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroup</span><span class="token punctuation">:</span> rbac.authorization.k8s.io
  <span class="token key atrule">kind</span><span class="token punctuation">:</span> Group
  <span class="token key atrule">name</span><span class="token punctuation">:</span> manager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>ç»‘å®šä¹‹åï¼Œä½ ä¸èƒ½å†ä¿®æ”¹ç»‘å®šå¯¹è±¡æ‰€å¼•ç”¨çš„Roleæˆ–ClusterRoleã€‚è¯•å›¾æ”¹å˜ç»‘å®šå¯¹è±¡çš„ roleRef å°†å¯¼è‡´åˆæ³•æ€§æ£€æŸ¥é”™è¯¯ã€‚å¦‚æœä½ æƒ³è¦æ”¹å˜ç°æœ‰ç»‘å®šå¯¹è±¡ä¸­ roleRefå­—æ®µçš„å†…å®¹ï¼Œå¿…é¡»åˆ é™¤é‡æ–°åˆ›å»ºç»‘å®šå¯¹è±¡ã€‚</code></p><p>è¿™ç§é™åˆ¶æœ‰ä¸¤ä¸ªä¸»è¦åŸå› ï¼š</p><ol><li>é’ˆå¯¹ä¸åŒè§’è‰²çš„ç»‘å®šæ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ç»‘å®šã€‚è¦æ±‚é€šè¿‡åˆ é™¤/é‡å»ºç»‘å®šæ¥æ›´æ”¹ <code>roleRef</code>, è¿™æ ·å¯ä»¥ç¡®ä¿è¦èµ‹äºˆç»‘å®šçš„æ‰€æœ‰ä¸»ä½“ä¼šè¢«æˆäºˆæ–°çš„è§’è‰²ï¼ˆè€Œä¸æ˜¯åœ¨å…è®¸æˆ–è€…ä¸å°å¿ƒä¿®æ”¹ äº† <code>roleRef</code> çš„æƒ…å†µä¸‹å¯¼è‡´æ‰€æœ‰ç°æœ‰ä¸»ä½“æœªç»éªŒè¯å³è¢«æˆäºˆæ–°è§’è‰²å¯¹åº”çš„æƒé™ï¼‰ã€‚</li><li>å°† <code>roleRef</code> è®¾ç½®ä¸ºä¸å¯ä»¥æ”¹å˜ï¼Œè¿™ä½¿å¾—å¯ä»¥ä¸ºç”¨æˆ·æˆäºˆå¯¹ç°æœ‰ç»‘å®šå¯¹è±¡çš„ <code>update</code> æƒé™ï¼Œ è¿™æ ·å¯ä»¥è®©ä»–ä»¬ç®¡ç†ä¸»ä½“åˆ—è¡¨ï¼ŒåŒæ—¶ä¸èƒ½æ›´æ”¹è¢«æˆäºˆè¿™äº›ä¸»ä½“çš„è§’è‰²ã€‚</li></ol><p><code>pods</code>å¯¹åº”åå­—ç©ºé—´ä½œç”¨åŸŸçš„Podèµ„æºï¼Œè€Œ <code>log</code> æ˜¯ <code>pods</code>çš„å­èµ„æºã€‚åœ¨RBACè§’è‰²è¡¨è¾¾å­èµ„æºæ—¶ï¼Œä½¿ç”¨æ–œçº¿ï¼ˆ<code>/</code>ï¼‰æ¥åˆ†éš”èµ„æºå’Œå­èµ„æºã€‚è¦å…è®¸æŸä¸»ä½“è¯»å– <code>pods</code> åŒæ—¶è®¿é—®è¿™äº›Podçš„ <code>log</code> å­èµ„æº</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Role
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> default
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>and<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>logs<span class="token punctuation">-</span>reader
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;pods&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pods/log&quot;</span><span class="token punctuation">]</span>			<span class="token comment">#pods/logæ˜¯podçš„èµ„æº</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">]</span>
 
<span class="token comment">#ä¹Ÿå¯ä»¥é€šè¿‡ resourceNames åˆ—è¡¨æŒ‰åç§°å¼•ç”¨èµ„æºã€‚</span>
<span class="token comment">#åœ¨ HTTP å±‚é¢ï¼Œç”¨æ¥è®¿é—® ConfigMap çš„èµ„æºçš„åç§°ä¸º &quot;configmaps&quot;</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;configmaps&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">resourceNames</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;my-configmap&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;get&quot;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="èšåˆçš„-clusterrole" tabindex="-1"><a class="header-anchor" href="#èšåˆçš„-clusterrole" aria-hidden="true">#</a> èšåˆçš„ ClusterRole</h3><p>ä½ å¯ä»¥å°†è‹¥å¹² ClusterRole <strong>èšåˆï¼ˆAggregateï¼‰</strong> èµ·æ¥ï¼Œå½¢æˆä¸€ä¸ªå¤åˆçš„ ClusterRoleã€‚ æŸä¸ªæ§åˆ¶å™¨ä½œä¸ºé›†ç¾¤æ§åˆ¶é¢çš„ä¸€éƒ¨åˆ†ä¼šç›‘è§†å¸¦æœ‰ <code>aggregationRule</code> çš„ ClusterRole å¯¹è±¡é›†åˆã€‚<code>aggregationRule</code> ä¸ºæ§åˆ¶å™¨å®šä¹‰ä¸€ä¸ªæ ‡ç­¾ <a href="https://kubernetes.io/zh/docs/concepts/overview/working-with-objects/labels/" target="_blank" rel="noopener noreferrer">é€‰æ‹©ç®—ç¬¦<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä¾›åè€…åŒ¹é… åº”è¯¥ç»„åˆåˆ°å½“å‰ ClusterRole çš„ <code>roles</code> å­—æ®µä¸­çš„ ClusterRole å¯¹è±¡ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªèšåˆ ClusterRole çš„ç¤ºä¾‹ï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> monitoring
<span class="token key atrule">aggregationRule</span><span class="token punctuation">:</span>
  <span class="token key atrule">clusterRoleSelectors</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">rbac.example.com/aggregate-to-monitoring</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token comment"># æ§åˆ¶é¢è‡ªåŠ¨å¡«å……è¿™é‡Œçš„è§„åˆ™</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>å¦‚æœä½ åˆ›å»ºä¸€ä¸ªä¸æŸç°æœ‰èšåˆ ClusterRole çš„æ ‡ç­¾é€‰æ‹©ç®—ç¬¦åŒ¹é…çš„ ClusterRoleï¼Œ è¿™ä¸€å˜åŒ–ä¼šè§¦å‘æ–°çš„è§„åˆ™è¢«æ·»åŠ åˆ°èšåˆ ClusterRole çš„æ“ä½œã€‚</li><li>é»˜è®¤çš„<a href="https://kubernetes.io/zh/docs/reference/access-authn-authz/rbac/#default-roles-and-role-bindings" target="_blank" rel="noopener noreferrer">é¢å‘ç”¨æˆ·çš„è§’è‰²<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> ä½¿ç”¨ ClusterRole èšåˆã€‚ è¿™ä½¿å¾—ä½œä¸ºé›†ç¾¤ç®¡ç†å‘˜çš„ä½ å¯ä»¥ä¸ºæ‰©å±•é»˜è®¤è§„åˆ™ï¼ŒåŒ…æ‹¬ä¸ºå®šåˆ¶èµ„æºè®¾ç½®è§„åˆ™ï¼Œ æ¯”å¦‚é€šè¿‡ CustomResourceDefinitions æˆ–èšåˆ API æœåŠ¡å™¨æä¾›çš„å®šåˆ¶èµ„æºã€‚</li></ul><p>ä¸‹é¢çš„ä¾‹å­ä¸­ï¼Œé€šè¿‡åˆ›å»ºä¸€ä¸ªæ ‡ç­¾åŒæ ·ä¸º <code>rbac.example.com/aggregate-to-monitoring: true</code> çš„ ClusterRoleï¼Œæ–°çš„è§„åˆ™å¯è¢«æ·»åŠ åˆ° &quot;monitoring&quot; ClusterRole ä¸­ã€‚</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> monitoring<span class="token punctuation">-</span>endpoints
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">rbac.example.com/aggregate-to-monitoring</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
<span class="token comment"># å½“ä½ åˆ›å»º &quot;monitoring-endpoints&quot; ClusterRole æ—¶ï¼Œ</span>
<span class="token comment"># ä¸‹é¢çš„è§„åˆ™ä¼šè¢«æ·»åŠ åˆ° &quot;monitoring&quot; ClusterRole ä¸­</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;services&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;endpoints&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;pods&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>ä¸‹é¢çš„ClusterRolesè®©é»˜è®¤è§’è‰² &quot;admin&quot;å’Œ&quot;edit&quot;æ‹¥æœ‰ç®¡ç†è‡ªå®šä¹‰èµ„æº &quot;CronTabs&quot; çš„æƒé™ï¼Œ&quot;view&quot; è§’è‰²å¯¹ CronTabèµ„æºæ‹¥æœ‰è¯»æ“ä½œæƒé™ã€‚ä½ å¯ä»¥å‡å®šCronTabå¯¹è±¡åœ¨APIæœåŠ¡å™¨æ‰€çœ‹åˆ°çš„URLä¸­è¢«å‘½åä¸º &quot;crontabs&quot;ã€‚</code></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> aggregate<span class="token punctuation">-</span>cron<span class="token punctuation">-</span>tabs<span class="token punctuation">-</span>edit
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token comment"># æ·»åŠ ä»¥ä¸‹æƒé™åˆ°é»˜è®¤è§’è‰² &quot;admin&quot; å’Œ &quot;edit&quot; ä¸­</span>
    <span class="token key atrule">rbac.authorization.k8s.io/aggregate-to-admin</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
    <span class="token key atrule">rbac.authorization.k8s.io/aggregate-to-edit</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;stable.example.com&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;crontabs&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;create&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;update&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;patch&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;delete&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">---</span>
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ClusterRole
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> rbac.authorization.k8s.io/v1
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> aggregate<span class="token punctuation">-</span>cron<span class="token punctuation">-</span>tabs<span class="token punctuation">-</span>view
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token comment"># æ·»åŠ ä»¥ä¸‹æƒé™åˆ° &quot;view&quot; é»˜è®¤è§’è‰²ä¸­</span>
    <span class="token key atrule">rbac.authorization.k8s.io/aggregate-to-view</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
<span class="token key atrule">rules</span><span class="token punctuation">:</span>
<span class="token punctuation">-</span> <span class="token key atrule">apiGroups</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;stable.example.com&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">resources</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;crontabs&quot;</span><span class="token punctuation">]</span>
  <span class="token key atrule">verbs</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;get&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;list&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;watch&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="é¢å‘ç”¨æˆ·çš„è§’è‰²" tabindex="-1"><a class="header-anchor" href="#é¢å‘ç”¨æˆ·çš„è§’è‰²" aria-hidden="true">#</a> é¢å‘ç”¨æˆ·çš„è§’è‰²</h3><ul><li>ä¸€äº›é»˜è®¤çš„ ClusterRole ä¸æ˜¯ä»¥å‰ç¼€ <code>system:</code> å¼€å¤´çš„ã€‚è¿™äº›æ˜¯é¢å‘ç”¨æˆ·çš„è§’è‰²ã€‚ å®ƒä»¬åŒ…æ‹¬è¶…çº§ç”¨æˆ·ï¼ˆSuper-Userï¼‰è§’è‰²ï¼ˆ<code>cluster-admin</code>ï¼‰ã€ ä½¿ç”¨ ClusterRoleBinding åœ¨é›†ç¾¤èŒƒå›´å†…å®Œæˆæˆæƒçš„è§’è‰²ï¼ˆ<code>cluster-status</code>ï¼‰ã€ ä»¥åŠä½¿ç”¨ RoleBinding åœ¨ç‰¹å®šåå­—ç©ºé—´ä¸­æˆäºˆçš„è§’è‰²ï¼ˆ<code>admin</code>ã€<code>edit</code>ã€<code>view</code>ï¼‰ã€‚</li><li>é¢å‘ç”¨æˆ·çš„ ClusterRole ä½¿ç”¨ <a href="https://kubernetes.io/zh/docs/reference/access-authn-authz/rbac/#aggregated-clusterroles" target="_blank" rel="noopener noreferrer">ClusterRole èšåˆ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ä»¥å…è®¸ç®¡ç†å‘˜åœ¨ è¿™äº› ClusterRole ä¸Šæ·»åŠ ç”¨äºå®šåˆ¶èµ„æºçš„è§„åˆ™ã€‚å¦‚æœæƒ³è¦æ·»åŠ è§„åˆ™åˆ° <code>admin</code>ã€<code>edit</code> æˆ–è€… <code>view</code>ï¼Œ å¯ä»¥åˆ›å»ºå¸¦æœ‰ä»¥ä¸‹ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡ç­¾çš„ ClusterRoleï¼š</li></ul><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">labels</span><span class="token punctuation">:</span>
    <span class="token key atrule">rbac.authorization.k8s.io/aggregate-to-admin</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
    <span class="token key atrule">rbac.authorization.k8s.io/aggregate-to-edit</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
    <span class="token key atrule">rbac.authorization.k8s.io/aggregate-to-view</span><span class="token punctuation">:</span> <span class="token string">&quot;true&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="podçš„å®‰å…¨ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#podçš„å®‰å…¨ç­–ç•¥" aria-hidden="true">#</a> Podçš„å®‰å…¨ç­–ç•¥</h2><p><code>PodSecurityPolicy åœ¨ Kubernetes v1.21 ç‰ˆæœ¬ä¸­è¢«å¼ƒç”¨ï¼Œå°†åœ¨ v1.25 ä¸­åˆ é™¤ã€‚</code></p><p>Pod å®‰å…¨ç­–ç•¥ä½¿å¾—å¯¹ Pod åˆ›å»ºå’Œæ›´æ–°è¿›è¡Œç»†ç²’åº¦çš„æƒé™æ§åˆ¶æˆä¸ºå¯èƒ½ã€‚</p><h3 id="ä»€ä¹ˆæ˜¯podå®‰å…¨ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#ä»€ä¹ˆæ˜¯podå®‰å…¨ç­–ç•¥" aria-hidden="true">#</a> ä»€ä¹ˆæ˜¯Podå®‰å…¨ç­–ç•¥ï¼Ÿ</h3><p><em>Pod å®‰å…¨ç­–ç•¥ï¼ˆPod Security Policyï¼‰</em> æ˜¯é›†ç¾¤çº§åˆ«çš„èµ„æºï¼Œå®ƒèƒ½å¤Ÿæ§åˆ¶ Pod è§„çº¦ ä¸­ä¸å®‰å…¨æ€§ç›¸å…³çš„å„ä¸ªæ–¹é¢ã€‚ <a href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#podsecuritypolicy-v1beta1-policy" target="_blank" rel="noopener noreferrer">PodSecurityPolicy<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> å¯¹è±¡å®šä¹‰äº†ä¸€ç»„ Pod è¿è¡Œæ—¶å¿…é¡»éµå¾ªçš„æ¡ä»¶åŠç›¸å…³å­—æ®µçš„é»˜è®¤å€¼ï¼Œåªæœ‰ Pod æ»¡è¶³è¿™äº›æ¡ä»¶ æ‰ä¼šè¢«ç³»ç»Ÿæ¥å—ã€‚ Pod å®‰å…¨ç­–ç•¥å…è®¸ç®¡ç†å‘˜æ§åˆ¶</p><p><strong><em>Pod å®‰å…¨ç­–ç•¥</em> ç”±è®¾ç½®å’Œç­–ç•¥ç»„æˆï¼Œå®ƒä»¬èƒ½å¤Ÿæ§åˆ¶ Pod è®¿é—®çš„å®‰å…¨ç‰¹å¾ã€‚è¿™äº›è®¾ç½®åˆ†ä¸ºå¦‚ä¸‹ä¸‰ç±»ï¼š</strong></p><ul><li><em>åŸºäºå¸ƒå°”å€¼æ§åˆ¶</em> ï¼šè¿™ç§ç±»å‹çš„å­—æ®µé»˜è®¤ä¸ºæœ€ä¸¥æ ¼é™åˆ¶çš„å€¼ã€‚</li><li><em>åŸºäºè¢«å…è®¸çš„å€¼é›†åˆæ§åˆ¶</em> ï¼šè¿™ç§ç±»å‹çš„å­—æ®µä¼šä¸è¿™ç»„å€¼è¿›è¡Œå¯¹æ¯”ï¼Œä»¥ç¡®è®¤å€¼è¢«å…è®¸ã€‚</li><li><em>åŸºäºç­–ç•¥æ§åˆ¶</em> ï¼šè®¾ç½®é¡¹é€šè¿‡ä¸€ç§ç­–ç•¥æä¾›çš„æœºåˆ¶æ¥ç”Ÿæˆè¯¥å€¼ï¼Œè¿™ç§æœºåˆ¶èƒ½å¤Ÿç¡®ä¿æŒ‡å®šçš„å€¼è½åœ¨è¢«å…è®¸çš„è¿™ç»„å€¼ä¸­ã€‚</li></ul><h3 id="å¯ç”¨podå®‰å…¨ç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#å¯ç”¨podå®‰å…¨ç­–ç•¥" aria-hidden="true">#</a> å¯ç”¨Podå®‰å…¨ç­–ç•¥</h3><p>Pod å®‰å…¨ç­–ç•¥å®ç°ä¸ºä¸€ç§å¯é€‰çš„ <a href="https://kubernetes.io/zh/docs/reference/access-authn-authz/admission-controllers/#podsecuritypolicy" target="_blank" rel="noopener noreferrer">å‡†å…¥æ§åˆ¶å™¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€‚ <a href="https://kubernetes.io/zh/docs/reference/access-authn-authz/admission-controllers/#how-do-i-turn-on-an-admission-control-plug-in" target="_blank" rel="noopener noreferrer">å¯ç”¨äº†å‡†å…¥æ§åˆ¶å™¨<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> å³å¯å¼ºåˆ¶å®æ–½ Pod å®‰å…¨ç­–ç•¥ï¼Œä¸è¿‡å¦‚æœæ²¡æœ‰æˆæƒè®¤å¯ç­–ç•¥ä¹‹å‰å³å¯ç”¨å‡†å…¥æ§åˆ¶å™¨å°†å¯¼è‡´é›†ç¾¤ä¸­æ— æ³•åˆ›å»ºä»»ä½• Podã€‚</p><p>ç”±äºPodå®‰å…¨ç­–ç•¥APIï¼ˆ<code>policy/v1beta1/podsecuritypolicy</code>ï¼‰æ˜¯ç‹¬ç«‹äºå‡†å…¥æ§åˆ¶å™¨ æ¥å¯ç”¨çš„ï¼Œå¯¹äºç°æœ‰é›†ç¾¤è€Œè¨€ï¼Œå»ºè®®åœ¨å¯ç”¨å‡†å…¥æ§åˆ¶å™¨ä¹‹å‰å…ˆæ·»åŠ ç­–ç•¥å¹¶å¯¹å…¶æˆæƒã€‚</p><h3 id="æˆæƒç­–ç•¥" tabindex="-1"><a class="header-anchor" href="#æˆæƒç­–ç•¥" aria-hidden="true">#</a> æˆæƒç­–ç•¥</h3><p>PodSecurityPolicy èµ„æºè¢«åˆ›å»ºæ—¶ï¼Œå¹¶ä¸æ‰§è¡Œä»»ä½•æ“ä½œã€‚ä¸ºäº†ä½¿ç”¨è¯¥èµ„æºï¼Œéœ€è¦å¯¹ å‘å‡ºè¯·æ±‚çš„ç”¨æˆ·æˆ–è€…ç›®æ ‡ Pod çš„ <a href="https://kubernetes.io/zh/docs/tasks/configure-pod-container/configure-service-account/" target="_blank" rel="noopener noreferrer">æœåŠ¡è´¦å·<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æˆæƒï¼Œé€šè¿‡å…è®¸å…¶å¯¹ç­–ç•¥æ‰§è¡Œ <code>use</code> åŠ¨è¯å…è®¸å…¶ä½¿ç”¨è¯¥ç­–ç•¥ã€‚</p><p>å¤§å¤šæ•° Kubernetes Pod ä¸æ˜¯ç”±ç”¨æˆ·ç›´æ¥åˆ›å»ºçš„ã€‚ç›¸åï¼Œè¿™äº› Pod æ˜¯ç”± <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer">Deployment<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>ã€ <a href="https://kubernetes.io/zh/docs/concepts/workloads/controllers/replicaset/" target="_blank" rel="noopener noreferrer">ReplicaSet<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a> æˆ–è€…ç»ç”±æ§åˆ¶å™¨ç®¡ç†å™¨æ¨¡ç‰ˆåŒ–çš„æ§åˆ¶å™¨åˆ›å»ºã€‚</p><p>èµ‹äºˆæ§åˆ¶å™¨è®¿é—®ç­–ç•¥çš„æƒé™æ„å‘³ç€å¯¹åº”æ§åˆ¶å™¨æ‰€åˆ›å»ºçš„ <em>æ‰€æœ‰</em> Pod éƒ½å¯è®¿é—®ç­–ç•¥ã€‚ å› æ­¤ï¼Œå¯¹ç­–ç•¥è¿›è¡Œæˆæƒçš„ä¼˜å…ˆæ–¹æ¡ˆæ˜¯ä¸º Pod çš„æœåŠ¡è´¦å·æˆäºˆè®¿é—®æƒé™</p><h3 id="é…ç½®" tabindex="-1"><a class="header-anchor" href="#é…ç½®" aria-hidden="true">#</a> é…ç½®</h3><p>ä¸ºè¿è¡Œæ­¤ç¤ºä¾‹ï¼Œé…ç½®ä¸€ä¸ªåå­—ç©ºé—´å’Œä¸€ä¸ªæœåŠ¡è´¦å·ã€‚æˆ‘ä»¬å°†ç”¨è¿™ä¸ªæœåŠ¡è´¦å·æ¥ æ¨¡æ‹Ÿä¸€ä¸ªéç®¡ç†å‘˜è´¦å·çš„ç”¨æˆ·ã€‚</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl create namespace psp-example</span>
<span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl create serviceaccount -n psp-example fake-user</span>
<span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl create rolebinding -n psp-example fake-editor --clusterrole=edit --serviceaccount=psp-example:fake-user</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åˆ›å»ºä¸¤ä¸ªåˆ«åï¼Œä»¥æ›´æ¸…æ™°åœ°å±•ç¤ºæˆ‘ä»¬æ‰€ä½¿ç”¨çš„ç”¨æˆ·è´¦å·ï¼ŒåŒæ—¶å‡å°‘ä¸€äº›é”®ç›˜è¾“å…¥ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># alias kubectl-admin=&#39;kubectl -n psp-example&#39;</span>
<span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># alias kubectl-user=&#39;kubectl --as=system:serviceaccount:psp-example:fake-user -n psp-example&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ›å»ºä¸€ä¸ªç­–ç•¥å’Œä¸€ä¸ªpod" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªç­–ç•¥å’Œä¸€ä¸ªpod" aria-hidden="true">#</a> åˆ›å»ºä¸€ä¸ªç­–ç•¥å’Œä¸€ä¸ªPod</h3><p>åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­å®šä¹‰ä¸€ä¸ªç¤ºä¾‹çš„ PodSecurityPolicy å¯¹è±¡ã€‚ è¿™é‡Œçš„ç­–ç•¥åªæ˜¯ç”¨æ¥ç¦æ­¢åˆ›å»ºæœ‰ç‰¹æƒè¦æ±‚çš„ Podsã€‚</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># cat podsecuritypolicy.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> policy/v1beta1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PodSecurityPolicy
<span class="token key atrule">metadata</span><span class="token punctuation">:</span> 
  <span class="token key atrule">name</span><span class="token punctuation">:</span> example 
<span class="token key atrule">spec</span><span class="token punctuation">:</span> 
  <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">false</span> 		<span class="token comment"># Don&#39;t allow privileged pods!</span>
  <span class="token key atrule">seLinux</span><span class="token punctuation">:</span> 					<span class="token comment"># å…¶ä½™éƒ¨åˆ†å¡«å†™ä¸€äº›å¿…å¡«å­—æ®µ</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> RunAsAny 
  <span class="token key atrule">supplementalGroups</span><span class="token punctuation">:</span>
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> RunAsAny
  <span class="token key atrule">runAsUser</span><span class="token punctuation">:</span> 
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> RunAsAny
  <span class="token key atrule">fsGroup</span><span class="token punctuation">:</span> 
    <span class="token key atrule">rule</span><span class="token punctuation">:</span> RunAsAny
  <span class="token key atrule">volumes</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token string">&#39;*&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨ kubectl æ‰§è¡Œåˆ›å»ºæ“ä½œï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl-admin create -f podsecuritypolicy.yaml</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œä½œä¸ºä¸€ä¸ªéç‰¹æƒç”¨æˆ·ï¼Œå°è¯•åˆ›å»ºä¸€ä¸ªç®€å•çš„ Podï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code>kubectl<span class="token punctuation">-</span>user create <span class="token punctuation">-</span>f<span class="token punctuation">-</span> &lt;&lt;EOF
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pause
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> pause
      <span class="token key atrule">image</span><span class="token punctuation">:</span> k8s.gcr.io/pause
EOF
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºç±»ä¼¼äºï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>Error from server <span class="token punctuation">(</span>Forbidden<span class="token punctuation">)</span>: error when creating <span class="token string">&quot;STDIN&quot;</span><span class="token builtin class-name">:</span> pods <span class="token string">&quot;pause&quot;</span> is forbidden: unable to validate against any pod security policy: <span class="token punctuation">[</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å°½ç®¡ PodSecurityPolicy è¢«åˆ›å»ºï¼ŒPod çš„æœåŠ¡è´¦å·æˆ–è€… <code>fake-user</code> ç”¨æˆ·éƒ½æ²¡æœ‰ä½¿ç”¨è¯¥ç­–ç•¥çš„æƒé™ã€‚</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl-user auth can-i use podsecuritypolicy/example</span>
Warning: resource <span class="token string">&#39;podsecuritypolicies&#39;</span> is not namespace scoped <span class="token keyword">in</span> group <span class="token string">&#39;policy&#39;</span>
no
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å‘½åç©ºé—´ä¸‹podé…é¢" tabindex="-1"><a class="header-anchor" href="#å‘½åç©ºé—´ä¸‹podé…é¢" aria-hidden="true">#</a> å‘½åç©ºé—´ä¸‹Podé…é¢</h2><p>Resource Quotasï¼ˆèµ„æºé…é¢ï¼Œç®€ç§°quotaï¼‰<code>æ˜¯å¯¹namespaceè¿›è¡Œèµ„æºé…é¢ï¼Œé™åˆ¶èµ„æºä½¿ç”¨çš„ä¸€ç§ç­–ç•¥ã€‚</code></p><p>K8Sæ˜¯ä¸€ä¸ªå¤šç”¨æˆ·æ¶æ„ï¼Œå½“å¤šç”¨æˆ·æˆ–è€…å›¢é˜Ÿå…±äº«ä¸€ä¸ªK8Sç³»ç»Ÿæ—¶ï¼ŒSAä½¿ç”¨quotaé˜²æ­¢ç”¨æˆ·ï¼ˆåŸºäºnamespaceçš„ï¼‰çš„èµ„æºæŠ¢å ï¼Œå®šä¹‰å¥½èµ„æºåˆ†é…ç­–ç•¥ã€‚</p><p>Quotaåº”ç”¨åœ¨Namespaceä¸Šï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡æœ‰Resource Quotaçš„ï¼Œéœ€è¦å¦å¤–åˆ›å»ºQuotaï¼Œ<code>å¹¶ä¸”æ¯ä¸ªNamespaceæœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªQuotaå¯¹è±¡ã€‚</code></p><h3 id="åˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´" aria-hidden="true">#</a> åˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´</h3><p>é¦–å…ˆåˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´ï¼Œè¿™æ ·å¯ä»¥å°†æœ¬æ¬¡æ“ä½œä¸­åˆ›å»ºçš„èµ„æºä¸é›†ç¾¤å…¶ä»–èµ„æºéš”ç¦»å¼€æ¥ã€‚</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl create namespace quota-pod-example </span>
namespace/quota-pod-example created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ›å»ºresourcequota" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºresourcequota" aria-hidden="true">#</a> åˆ›å»ºResourceQuota</h3><p><code>åˆ›å»ºä¸€ä¸ªquotaé™åˆ¶æœ€å¤§çš„podæ•°é‡æ˜¯2ä¸ª</code></p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl create quota pod-demo --hard=pods=2 --namespace=quota-pod-example --dry-run -o yaml &gt; quota.yaml       </span>

<span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># cat quota.yaml  </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ResourceQuota
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pod<span class="token punctuation">-</span>demo
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> quota<span class="token punctuation">-</span>pod<span class="token punctuation">-</span>example
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">hard</span><span class="token punctuation">:</span>
    <span class="token key atrule">pods</span><span class="token punctuation">:</span> <span class="token string">&quot;2&quot;</span>
<span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="éªŒè¯è¯¥èµ„æºé™åˆ¶" tabindex="-1"><a class="header-anchor" href="#éªŒè¯è¯¥èµ„æºé™åˆ¶" aria-hidden="true">#</a> éªŒè¯è¯¥èµ„æºé™åˆ¶</h3><p><code>è¿™é‡Œä½¿ç”¨deploymentçš„æ§åˆ¶å™¨æ¥åˆ›å»º3ä¸ªPod</code>ï¼Œæ­¤æ—¶ä¼šå‘ç°ï¼Œdeploymentçš„podè¢«é™åˆ¶æˆ2ä¸ªpod</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl create deployment nginx --image=172.25.253.3/library/nginx --replicas=3 --namespace quota-pod-example </span>
deployment.apps/nginx created

<span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl get deployments.apps -n quota-pod-example  </span>
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
nginx   <span class="token number">2</span>/3     <span class="token number">2</span>            <span class="token number">2</span>           11s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ¸…ç†" tabindex="-1"><a class="header-anchor" href="#æ¸…ç†" aria-hidden="true">#</a> æ¸…ç†</h3><p>åˆ é™¤å‘½åç©ºé—´</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl delete namespaces quota-pod-example </span>
namespace <span class="token string">&quot;quota-pod-example&quot;</span> deleted
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="é…ç½®apiå¯¹è±¡é…é¢" tabindex="-1"><a class="header-anchor" href="#é…ç½®apiå¯¹è±¡é…é¢" aria-hidden="true">#</a> é…ç½®APIå¯¹è±¡é…é¢</h2><h3 id="åˆ›å»ºå‘½åç©ºé—´" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºå‘½åç©ºé—´" aria-hidden="true">#</a> åˆ›å»ºå‘½åç©ºé—´</h3><p>åˆ›å»ºä¸€ä¸ªå‘½åç©ºé—´ä»¥ä¾¿æœ¬ä¾‹ä¸­åˆ›å»ºçš„èµ„æºå’Œé›†ç¾¤ä¸­çš„å…¶ä½™éƒ¨åˆ†ç›¸éš”ç¦»ã€‚</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl create namespace quota-object-example</span>
namespace/quota-object-example created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ›å»ºresourcequota-1" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºresourcequota-1" aria-hidden="true">#</a> åˆ›å»ºResourceQuota</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ª ResourceQuota å¯¹è±¡çš„é…ç½®æ–‡ä»¶</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl create quota object-quota-demo --namespace quota-object-example --hard=persistentvolumeclaims=1,services.loadbalancers=2,services.nodeports=0 --dry-run -o yaml &gt; quota-api.yaml                  </span>

<span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># cat  quota-api.yaml    </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> ResourceQuota
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">creationTimestamp</span><span class="token punctuation">:</span> <span class="token null important">null</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> object<span class="token punctuation">-</span>quota<span class="token punctuation">-</span>demo
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> quota<span class="token punctuation">-</span>object<span class="token punctuation">-</span>example
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">hard</span><span class="token punctuation">:</span>
    <span class="token key atrule">persistentvolumeclaims</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span>
    <span class="token key atrule">services.loadbalancers</span><span class="token punctuation">:</span> <span class="token string">&quot;2&quot;</span>
    <span class="token key atrule">services.nodeports</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
<span class="token key atrule">status</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f quota-api.yaml </span>
resourcequota/object<span class="token punctuation">-</span>quota<span class="token punctuation">-</span>demo created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æŸ¥çœ‹ ResourceQuota çš„è¯¦ç»†ä¿¡æ¯ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>kubectl get resourcequota object-quota-demo <span class="token parameter variable">--namespace</span><span class="token operator">=</span>quota-object-example <span class="token parameter variable">--output</span><span class="token operator">=</span>yaml
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>è¾“å‡ºç»“æœè¡¨æ˜åœ¨ quota-object-example å‘½åç©ºé—´ä¸­ï¼Œè‡³å¤šåªèƒ½æœ‰ä¸€ä¸ª PersistentVolumeClaimï¼Œ æœ€å¤šä¸¤ä¸ª LoadBalancer ç±»å‹çš„æœåŠ¡ï¼Œä¸èƒ½æœ‰ NodePort ç±»å‹çš„æœåŠ¡ã€‚</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">status</span><span class="token punctuation">:</span>
  <span class="token key atrule">hard</span><span class="token punctuation">:</span>
    <span class="token key atrule">persistentvolumeclaims</span><span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span>
    <span class="token key atrule">services.loadbalancers</span><span class="token punctuation">:</span> <span class="token string">&quot;2&quot;</span>
    <span class="token key atrule">services.nodeports</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
  <span class="token key atrule">used</span><span class="token punctuation">:</span>
    <span class="token key atrule">persistentvolumeclaims</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
    <span class="token key atrule">services.loadbalancers</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
    <span class="token key atrule">services.nodeports</span><span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="åˆ›å»ºpersistentvolumeclaim" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºpersistentvolumeclaim" aria-hidden="true">#</a> åˆ›å»ºPersistentVolumeClaim</h3><p>ä¸‹é¢æ˜¯ä¸€ä¸ª PersistentVolumeClaim å¯¹è±¡çš„é…ç½®æ–‡ä»¶ï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># cat pvc.yaml </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> quota<span class="token punctuation">-</span>object<span class="token punctuation">-</span>example
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pvc<span class="token punctuation">-</span>quota<span class="token punctuation">-</span>demo
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> manual
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 3Gi

<span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pvc.yaml </span>
persistentvolumeclaim/pvc<span class="token punctuation">-</span>quota<span class="token punctuation">-</span>demo created
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¾“å‡ºä¿¡æ¯è¡¨æ˜ PersistentVolumeClaim å­˜åœ¨å¹¶ä¸”å¤„äº Pending çŠ¶æ€ï¼š</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl get pvc -n quota-object-example</span>
NAME             STATUS    VOLUME   CAPACITY   ACCESS MODES   STORAGECLASS   AGE
pvc-quota-demo   Pending                                      manual         6s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å°è¯•åˆ›å»ºç¬¬äºŒä¸ªpersistentvolumeclaim" tabindex="-1"><a class="header-anchor" href="#å°è¯•åˆ›å»ºç¬¬äºŒä¸ªpersistentvolumeclaim" aria-hidden="true">#</a> å°è¯•åˆ›å»ºç¬¬äºŒä¸ªPersistentVolumeClaim</h3><p>ä¸‹é¢æ˜¯ç¬¬äºŒä¸ª PersistentVolumeClaim çš„é…ç½®æ–‡ä»¶ï¼š</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># vim pvc.yaml              </span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> PersistentVolumeClaim
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> quota<span class="token punctuation">-</span>object<span class="token punctuation">-</span>example
  <span class="token key atrule">name</span><span class="token punctuation">:</span> pvc<span class="token punctuation">-</span>quota<span class="token punctuation">-</span>demo2
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">storageClassName</span><span class="token punctuation">:</span> manual
  <span class="token key atrule">accessModes</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> ReadWriteOnce
  <span class="token key atrule">resources</span><span class="token punctuation">:</span>
    <span class="token key atrule">requests</span><span class="token punctuation">:</span>
      <span class="token key atrule">storage</span><span class="token punctuation">:</span> 4Gi
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å°è¯•åˆ›å»ºç¬¬äºŒä¸ª PersistentVolumeClaimï¼š</p><p><code>è¾“å‡ºä¿¡æ¯è¡¨æ˜ç¬¬äºŒä¸ª PersistentVolumeClaim æ²¡æœ‰åˆ›å»ºæˆåŠŸï¼Œå› ä¸ºè¿™ä¼šè¶…å‡ºå‘½åç©ºé—´çš„é…é¢ã€‚</code></p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token punctuation">[</span>root@master pod<span class="token punctuation">]</span><span class="token comment"># kubectl apply -f pvc.yaml</span>
Error from server <span class="token punctuation">(</span>Forbidden<span class="token punctuation">)</span>: error when creating <span class="token string">&quot;pvc.yaml&quot;</span><span class="token builtin class-name">:</span> persistentvolumeclaims <span class="token string">&quot;pvc-quota-demo3&quot;</span> is forbidden: exceeded quota: object-quota-demo, requested: <span class="token assign-left variable">persistentvolumeclaims</span><span class="token operator">=</span><span class="token number">1</span>, used: <span class="token assign-left variable">persistentvolumeclaims</span><span class="token operator">=</span><span class="token number">1</span>, limited: <span class="token assign-left variable">persistentvolumeclaims</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/vuepress-theme-hope/vuepress-theme-hope/edit/main/demo/theme-docs/src/zh/isKcount/2/CKA/14.é«˜çº§è¿ç»´.md" rel="noopener noreferrer" target="_blank" aria-label="åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: admin@example.com">Administrator</span><!--]--><!--]--></div></footer><!----><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer">é»˜è®¤é¡µè„š</div><div class="copyright">Copyright Â© 2022 isKcount</div></footer><!--]--></div><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/cicd/assets/app.4cf02e25.js" defer></script>
  </body>
</html>
